<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business DNA Analyzer</title>
    <!-- External Libraries -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>

    <style>
        /* Variables */
        :root {
            --primary-color: #3498db;
            --secondary-color: #2ecc71;
            --accent-color: #e74c3c;
            --text-color: #2c3e50;
            --background-color: #ffffff;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.12);
            --shadow-md: 0 4px 6px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 15px rgba(0,0,0,0.1);
            --transition-fast: 0.2s ease;
            --transition-normal: 0.3s ease;
            --transition-slow: 0.5s ease;
        }

        /* Loading Animation
        .loading {
            position: fixed;
            inset: 0;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(5px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        } */

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid var(--background-color);
            border-top: 3px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s cubic-bezier(0.68, -0.55, 0.265, 1.55) infinite;
        }

        /* Multiple Loading Animations */
        @keyframes spin {
            0% { transform: rotate(0deg) scale(1); }
            50% { transform: rotate(180deg) scale(1.1); }
            100% { transform: rotate(360deg) scale(1); }
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.7; }
            100% { transform: scale(1); opacity: 1; }
        }

        /* Enhanced Chart Container */
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
            background: linear-gradient(to right, #f8fafc, #ffffff);
            border-radius: 12px;
            padding: 1rem;
            box-shadow: var(--shadow-md);
            transition: var(--transition-normal);
        }

        .chart-container:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }
        .chart-container1:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-18px);
        }


        /* Modern Scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 8px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            border-radius: 8px;
            border: 2px solid #f1f1f1;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(45deg, var(--secondary-color), var(--primary-color));
        }

        /* Print Styles */
        @media print {
            .no-print {
                display: none !important;
            }
            
            .page-break {
                page-break-before: always;
                margin-top: 2rem;
            }
            
            body {
                color: #000;
                background: #fff;
            }
        }

        /* Enhanced Animations */
        .fade-in {
            animation: fadeIn 0.7s cubic-bezier(0.4, 0, 0.2, 1);
            will-change: opacity;
        }

        @keyframes fadeIn {
            from { 
                opacity: 0;
                transform: translateY(10px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }

        .slide-in {
            animation: slideIn 0.8s cubic-bezier(0.16, 1, 0.3, 1);
            will-change: transform, opacity;
        }

        @keyframes slideIn {
            0% { 
                transform: translateY(30px) scale(0.95);
                opacity: 0;
            }
            100% { 
                transform: translateY(0) scale(1);
                opacity: 1;
            }
        }

        /* Modern Form Elements */
        .custom-input {
            transition: all var(--transition-normal);
            border: 2px solid transparent;
            border-radius: 8px;
            padding: 0.75rem 1rem;
            background: #f8fafc;
        }

        .custom-input:focus {
            transform: scale(1.02);
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(52, 152, 219, 0.1);
            outline: none;
        }

        /* Enhanced Tooltip */
        .tooltip {
            position: relative;
            display: inline-block;
        }

        .tooltip .tooltip-text {
            visibility: hidden;
            width: max-content;
            max-width: 250px;
            background: linear-gradient(135deg, #2c3e50, #3498db);
            color: #fff;
            text-align: center;
            border-radius: 8px;
            padding: 8px 12px;
            position: absolute;
            z-index: 1000;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%) scale(0.9);
            opacity: 0;
            transition: all var(--transition-normal);
            box-shadow: var(--shadow-lg);
        }

        .tooltip .tooltip-text::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #3498db transparent transparent transparent;
        }

        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
            transform: translateX(-50%) scale(1);
        }

        /* Enhanced Cards */
        .hover-card {
            background: var(--background-color);
            border-radius: 12px;
            padding: 1.5rem;
            transition: all var(--transition-normal);
            position: relative;
            overflow: hidden;
        }

        .hover-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            transform: scaleX(0);
            transition: transform var(--transition-normal);
        }

        .hover-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-lg);
        }

        .hover-card:hover::before {
            transform: scaleX(1);
        }

        /* Metric Card with Glass Morphism */
        .metric-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.5);
            transition: all var(--transition-normal);
        }

        .metric-card:hover {
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transform: translateY(-5px) scale(1.02);
            border-color: var(--primary-color);
        }

        /* Utility Classes */
        .glass-effect {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .text-gradient {
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .shadow-hover {
            transition: box-shadow var(--transition-normal);
        }

        .shadow-hover:hover {
            box-shadow: var(--shadow-lg);
        }
        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
        }
        
        .info-icon {
            color: #3b82f6;
            font-size: 16px;
            margin-left: 4px;
        }
        
        .section-help {
            font-size: 14px;
            color: #6b7280;
            margin-bottom: 16px;
            font-style: italic;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Progress Bar -->
    <div id="progressBar" class="fixed top-0 left-0 w-full h-1 bg-blue-200 hidden">
        <div class="h-full bg-blue-600 transition-all duration-300" style="width: 0%"></div>
    </div>

    <!-- Main Container -->
    <div class="container mx-auto px-4 py-8">
        <!-- Header Section -->
        <div class="text-center mb-12 slide-in">
            <h1 class="text-4xl font-bold text-gray-800 mb-4">Business DNA Analyzer</h1>
            <p class="text-xl text-gray-600">Unlock Your Business's Hidden Strengths: Discover Your Unique Business DNA</p>
        </div>

        <!-- Main Form -->
        <div class="max-w-6xl mx-auto bg-white rounded-xl shadow-lg p-8 hover-card">
            <form id="analysisForm" class="space-y-8">
                <!-- Company Information -->
                <div class="bg-gray-50 p-6 rounded-lg fade-in">
                    <h2 class="text-2xl font-semibold text-gray-800 mb-2">Company Information</h2>
                    <p class="section-help">Basic details about your organization's identity and classification</p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Company Name
                                <span class="tooltip" data-tippy-content="The legal registered name of your organization">
                                    <i class="info-icon">ⓘ</i>
                                </span>
                            </label>
                            <input type="text" name="company_name" required
                                class="custom-input w-full px-4 py-2 rounded-md border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                placeholder="Enter company name">
                        </div>
        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Industry
                                <span class="tooltip" data-tippy-content="The primary sector in which your company operates">
                                    <i class="info-icon">ⓘ</i>
                                </span>
                            </label>
                            <select name="industry" required
                                class="custom-input w-full px-4 py-2 rounded-md border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <option value="">Select Industry</option>
                                <option value="technology">Technology</option>
                                <option value="retail">Retail</option>
                                <option value="manufacturing">Manufacturing</option>
                                <option value="fmcg">FMCG (Fast-Moving Consumer Goods)</option>
                                <option value="healthcare">Healthcare</option>
                                <option value="financial">Financial Services</option>
                                <option value="telecommunications">Telecommunications</option>
                                <option value="energy">Energy</option>
                                <option value="automotive">Automotive</option>
                                <option value="pharmaceuticals">Pharmaceuticals</option>
                                <option value="real_estate">Real Estate</option>
                                <option value="media_entertainment">Media & Entertainment</option>
                                <option value="agriculture">Agriculture</option>
                                <option value="aerospace_defense">Aerospace & Defense</option>
                                <option value="biotechnology">Biotechnology</option>
                                <option value="chemicals">Chemicals</option>
                                <option value="construction">Construction</option>
                                <option value="education">Education</option>
                                <option value="hospitality">Hospitality</option>
                                <option value="mining">Mining</option>
                            </select>
                        </div>
        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Year Founded
                                <span class="tooltip" data-tippy-content="The year your company was officially established">
                                    <i class="info-icon">ⓘ</i>
                                </span>
                            </label>
                            <input type="number" name="year_founded" required min="1900" max="2024"
                                class="custom-input w-full px-4 py-2 rounded-md border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                placeholder="e.g., 2010">
                        </div>
                    </div>
                </div>
        
                <!-- Financial Information -->
                <div class="bg-gray-50 p-6 rounded-lg fade-in">
                    <h2 class="text-2xl font-semibold text-gray-800 mb-2">Financial Information</h2>
                    <p class="section-help">Key financial metrics that define your company's economic health</p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Annual Revenue (₹)
                                <span class="tooltip" data-tippy-content="Total income generated from all business activities in the last fiscal year">
                                    <i class="info-icon">ⓘ</i>
                                </span>
                            </label>
                            <input type="number" name="revenue" required min="0"
                                class="custom-input w-full px-4 py-2 rounded-md border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                placeholder="e.g., 10000000">
                        </div>
        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Annual Profit (₹)
                                <span class="tooltip" data-tippy-content="Net income after deducting all expenses, taxes, and costs">
                                    <i class="info-icon">ⓘ</i>
                                </span>
                            </label>
                            <input type="number" name="profit" required
                                class="custom-input w-full px-4 py-2 rounded-md border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                placeholder="e.g., 2000000">
                        </div>
        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Annual Expenses (₹)
                                <span class="tooltip" data-tippy-content="Total costs incurred in running the business operations for a year">
                                    <i class="info-icon">ⓘ</i>
                                </span>
                            </label>
                            <input type="number" name="expenses" required min="0"
                                class="custom-input w-full px-4 py-2 rounded-md border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                placeholder="e.g., 8000000">
                        </div>
        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Current Assets (₹)
                                <span class="tooltip" data-tippy-content="Resources that can be converted to cash within one year (cash, inventory, receivables)">
                                    <i class="info-icon">ⓘ</i>
                                </span>
                            </label>
                            <input type="number" name="current_assets" required min="0"
                                class="custom-input w-full px-4 py-2 rounded-md border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                placeholder="e.g., 5000000">
                        </div>
        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Current Liabilities (₹)
                                <span class="tooltip" data-tippy-content="Debts and obligations due within one year">
                                    <i class="info-icon">ⓘ</i>
                                </span>
                            </label>
                            <input type="number" name="current_liabilities" required min="0"
                                class="custom-input w-full px-4 py-2 rounded-md border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                placeholder="e.g., 3000000">
                        </div>
        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Inventory Value (₹)
                                <span class="tooltip" data-tippy-content="Total value of goods and materials held for sale or production">
                                    <i class="info-icon">ⓘ</i>
                                </span>
                            </label>
                            <input type="number" name="inventory" required min="0"
                                class="custom-input w-full px-4 py-2 rounded-md border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                placeholder="e.g., 1500000">
                        </div>
                    </div>
                </div>
        
                <!-- Market Position -->
                <div class="bg-gray-50 p-6 rounded-lg fade-in">
                    <h2 class="text-2xl font-semibold text-gray-800 mb-2">Market Position</h2>
                    <p class="section-help">Indicators of your company's competitive standing in the market</p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Market Share (%)
                                <span class="tooltip" data-tippy-content="Percentage of total market sales volume captured by your company">
                                    <i class="info-icon">ⓘ</i>
                                </span>
                            </label>
                            <input type="number" name="market_share" required min="0" max="100" step="0.01"
                                class="custom-input w-full px-4 py-2 rounded-md border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                placeholder="e.g., 15.5">
                        </div>
        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Number of Major Competitors
                                <span class="tooltip" data-tippy-content="Count of significant rivals competing in your primary market">
                                    <i class="info-icon">ⓘ</i>
                                </span>
                            </label>
                            <input type="number" name="competitors" required min="0"
                                class="custom-input w-full px-4 py-2 rounded-md border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                placeholder="e.g., 5">
                        </div>
        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Total Employees
                                <span class="tooltip" data-tippy-content="Current total workforce, including full-time and part-time employees">
                                    <i class="info-icon">ⓘ</i>
                                </span>
                            </label>
                            <input type="number" name="total_employees" required min="1"
                                class="custom-input w-full px-4 py-2 rounded-md border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                placeholder="e.g., 100">
                        </div>
        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                R&D Investment (₹)
                                <span class="tooltip" data-tippy-content="Annual investment in research and development activities">
                                    <i class="info-icon">ⓘ</i>
                                </span>
                            </label>
                            <input type="number" name="rd_investment" required min="0"
                                class="custom-input w-full px-4 py-2 rounded-md border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                placeholder="e.g., 1000000">
                        </div>
                    </div>
                </div>
        
                <!-- Historical Data -->
                <div class="bg-gray-50 p-6 rounded-lg fade-in">
                    <h2 class="text-2xl font-semibold text-gray-800 mb-2">Historical Data</h2>
                    <p class="section-help">Past performance metrics to analyze growth trends</p>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Historical Revenue (Last 5 years, comma-separated, in ₹)
                            <span class="tooltip" data-tippy-content="Annual revenue figures for the past 5 years, starting from oldest to newest">
                                <i class="info-icon">ⓘ</i>
                            </span>
                        </label>
                        <input type="text" name="historical_revenue" required
                            class="custom-input w-full px-4 py-2 rounded-md border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                            placeholder="10000000,12000000,15000000,18000000,20000000">
                        <p class="mt-2 text-sm text-gray-500">Enter values from oldest to newest, separated by commas</p>
                    </div>
                </div>
        
                <!-- Submit Button -->
                <div class="flex justify-center">
                    <button type="submit"
                        class="px-8 py-3 bg-blue-600 text-white text-lg font-semibold rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-500 focus:ring-opacity-50 transition-colors transform hover:scale-105">
                        Analyze Business DNA
                    </button>
                </div>
            </form>
        
        </div>

        <!-- Results Section -->
        <div id="results" class="mt-12 hidden slide-in">
            <!-- Company Overview -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-8 hover-card">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">Company Overview</h2>
                    <span id="companyName" class="text-xl text-gray-600"></span>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="p-4 bg-gray-50 rounded-lg metric-card">
                        <h3 class="font-semibold text-gray-700 mb-2">Overall Performance</h3>
                        <div class="chart-container">
                            <canvas id="performanceGauge"></canvas>
                        </div>
                    </div>
                    <!-- <div class="md:col-span-2">
                        <div class="chart-container">
                            <canvas id="kpiComparisonChart"></canvas>
                        </div>
                    </div> -->
                </div>
            </div>

            <!-- Financial Analysis -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-6 hover-card">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">Financial Analysis</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="chart-container1">
                        <canvas id="financialMetricsChart"></canvas>
                    </div>
                    <div id="financialMetrics" class="space-y-4">
                        <!-- Financial metrics will be inserted here -->
                    </div>
                </div>
            </div>

            <!-- Growth Analysis -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-8 hover-card">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">Growth Analysis</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="chart-container">
                        <canvas id="trendAnalysisChart"></canvas>
                    </div>
                    <div id="growthMetrics" class="space-y-4">
                        <!-- Growth metrics will be inserted here -->
                    </div>
                </div>
            </div>

            <!-- Risk Analysis -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-8 hover-card">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">Risk Analysis</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="chart-container1">
                        <canvas id="riskRadarChart"></canvas>
                    </div>
                    <div id="riskMetrics" class="space-y-4">
                        <!-- Risk metrics will be inserted here -->
                    </div>
                </div>
            </div>

            <!-- Market Position -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-8 hover-card">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">Market Position</h2>
                <div id="marketMetrics" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Market metrics will be inserted here -->
                </div>
            </div>

            <!-- SWOT Analysis -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-8 hover-card">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">SWOT Analysis</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-green-50 p-4 rounded-lg metric-card">
                        <h3 class="font-semibold text-green-800 mb-3">Strengths</h3>
                        <div id="swotStrengths" class="space-y-2">
                            <!-- Strengths will be inserted here -->
                        </div>
                    </div>
                    <div class="bg-red-50 p-4 rounded-lg metric-card">
                        <h3 class="font-semibold text-red-800 mb-3">Weaknesses</h3>
                        <div id="swotWeaknesses" class="space-y-2">
                            <!-- Weaknesses will be inserted here -->
                        </div>
                    </div>
                    <div class="bg-blue-50 p-4 rounded-lg metric-card">
                        <h3 class="font-semibold text-blue-800 mb-3">Opportunities</h3>
                        <div id="swotOpportunities" class="space-y-2">
                            <!-- Opportunities will be inserted here -->
                        </div>
                    </div>
                    <div class="bg-yellow-50 p-4 rounded-lg metric-card">
                        <h3 class="font-semibold text-yellow-800 mb-3">Threats</h3>
                        <div id="swotThreats" class="space-y-2">
                            <!-- Threats will be inserted here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recommendations -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-8 hover-card">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">Strategic Recommendations</h2>
                <div id="recommendations" class="space-y-4">
                    <!-- Recommendations will be inserted here -->
                </div>
            </div>

            <!-- Compliance Status -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-8 hover-card">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">Compliance Status</h2>
                <div id="complianceStatus" class="space-y-4">
                    <!-- Compliance status will be inserted here -->
                </div>
            </div>

            <!-- Export Options -->
            <div class="flex justify-end space-x-4 mt-8">
                <button onclick="exportToPDF()" 
                    class="px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 focus:outline-none focus:ring-4 focus:ring-red-500 focus:ring-opacity-50 transition-colors transform hover:scale-105">
                    <span class="flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                        Export to PDF
                    </span>
                </button>
                <button onclick="exportToExcel()"
                    class="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 focus:outline-none focus:ring-4 focus:ring-green-500 focus:ring-opacity-50 transition-colors transform hover:scale-105">
                    <span class="flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                        Export to Excel
                    </span>
                </button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="mt-12 text-center text-gray-600">
        <p>© 2024-25 Pearl. All rights reserved.</p>
    </footer>

    <!-- Notification Component -->
    <div id="notification" class="fixed top-4 right-4 max-w-sm bg-white rounded-lg shadow-lg p-4 hidden transform transition-all duration-300">
        <div class="flex items-center">
            <div class="flex-shrink-0">
                <svg class="h-6 w-6 text-green-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
            </div>
            <div class="ml-3">
                <p id="notificationMessage" class="text-sm font-medium text-gray-900"></p>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading hidden">
        <div class="loading-spinner"></div>
    </div>

    <!-- JavaScript -->
    <script>
        // Chart.js Global Configuration
Chart.defaults.font.family = '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif';
Chart.defaults.color = '#4B5563';
Chart.defaults.plugins.tooltip.backgroundColor = 'rgba(0, 0, 0, 0.8)';
Chart.defaults.plugins.legend.position = 'bottom';

// Utility Functions
function formatIndianCurrency(amount) {
    return new Intl.NumberFormat('en-IN', {
        style: 'currency',
        currency: 'INR',
        maximumFractionDigits: 0
    }).format(amount);
}

function formatPercentage(value) {
    return new Intl.NumberFormat('en-IN', {
        style: 'percent',
        minimumFractionDigits: 1,
        maximumFractionDigits: 1
    }).format(value / 100);
}

function showNotification(message, type = 'success') {
    const notification = document.getElementById('notification');
    const notificationMessage = document.getElementById('notificationMessage');
    const icon = notification.querySelector('svg');
    
    notificationMessage.textContent = message;
    
    if (type === 'error') {
        icon.classList.remove('text-green-400');
        icon.classList.add('text-red-400');
        notification.classList.add('bg-red-50');
    } else {
        icon.classList.remove('text-red-400');
        icon.classList.add('text-green-400');
        notification.classList.remove('bg-red-50');
    }
    
    notification.classList.remove('hidden');
    
    setTimeout(() => {
        notification.classList.add('hidden');
    }, 3000);
}

function showLoading() {
    document.getElementById('loadingOverlay').classList.remove('hidden');
    document.getElementById('progressBar').classList.remove('hidden');
    simulateProgress();
}

function hideLoading() {
    document.getElementById('loadingOverlay').classList.add('hidden');
    document.getElementById('progressBar').classList.add('hidden');
    resetProgress();
}

function simulateProgress() {
    const progressBar = document.querySelector('#progressBar > div');
    let width = 0;
    const interval = setInterval(() => {
        if (width >= 90) {
            clearInterval(interval);
        } else {
            width += Math.random() * 30;
            progressBar.style.width = Math.min(width, 90) + '%';
        }
    }, 500);
}

function resetProgress() {
    const progressBar = document.querySelector('#progressBar > div');
    progressBar.style.width = '0%';
}

// Form Validation Functions
function validateFinancialData(data) {
    const revenue = parseFloat(data.revenue);
    const profit = parseFloat(data.profit);
    const expenses = parseFloat(data.expenses);
    
    if (revenue < profit) {
        throw new Error('Revenue cannot be less than profit');
    }
    
    if (revenue < expenses) {
        throw new Error('Revenue cannot be less than expenses');
    }
    
    if ((profit + expenses) > revenue) {
        throw new Error('Profit plus expenses cannot exceed revenue');
    }
    
    return true;
}

function validateHistoricalData(data) {
    const historicalRevenue = data.historical_revenue.split(',').map(Number);
    
    if (historicalRevenue.length !== 5) {
        throw new Error('Please provide exactly 5 years of historical revenue data');
    }
    
    if (historicalRevenue.some(isNaN)) {
        throw new Error('Historical revenue must contain valid numbers');
    }
    
    if (historicalRevenue.some(value => value < 0)) {
        throw new Error('Historical revenue cannot contain negative values');
    }
    
    return true;
}

// Chart Creation Functions
// Utility Functions
function getScoreColor(score) {
    if (score >= 80) return '#22c55e';      // Green
    if (score >= 60) return '#eab308';      // Yellow
    if (score >= 40) return '#f97316';      // Orange
    return '#ef4444';                       // Red
}

function lerp(start, end, t) {
    return start * (1 - t) + end * t;
}

// Enhanced Chart Creation Function
function createPerformanceGauge(score, options = {}) {
    const defaultOptions = {
        targetElement: 'performanceGauge',
        size: { width: 300, height: 200 },
        colors: {
            background: 'rgb(229, 231, 235)',
            text: '#1f2937',
            subText: '#6b7280'
        },
        animation: {
            duration: 1500,
            easing: 'easeOutCubic'
        },
        labels: {
            title: 'Performance',
            subtitle: 'Current Score',
            minLabel: '0%',
            maxLabel: '100%'
        },
        thresholds: [
            { value: 40, color: '#ef4444' },
            { value: 60, color: '#f97316' },
            { value: 80, color: '#eab308' },
            { value: 100, color: '#22c55e' }
        ]
    };

    // Merge default options with provided options
    options = { ...defaultOptions, ...options };

    const ctx = document.getElementById(options.targetElement).getContext('2d');
    const canvas = ctx.canvas;
    canvas.width = options.size.width;
    canvas.height = options.size.height;

    // Create gradient for smoother color transitions
    const gradientArc = ctx.createLinearGradient(0, 0, canvas.width, 0);
    options.thresholds.forEach((threshold, index) => {
        const position = threshold.value / 100;
        gradientArc.addColorStop(position, threshold.color);
    });

    // Initialize chart with animation
    let currentScore = 0;
    const chart = new Chart(ctx, {
        type: 'doughnut',
        data: {
            datasets: [{
                data: [currentScore, 100 - currentScore],
                backgroundColor: [
                    getScoreColor(currentScore),
                    options.colors.background
                ],
                borderWidth: 0
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            circumference: 180,
            rotation: 270,
            cutout: '80%',
            plugins: {
                tooltip: { enabled: false },
                legend: { display: false },
                title: {
                    display: true,
                    text: options.labels.title,
                    color: options.colors.text,
                    font: {
                        size: 16,
                        weight: 'bold'
                    },
                    padding: {
                        top: 10,
                        bottom: 5
                    }
                }
            }
        }
    });

    // Animate the gauge
    const startTime = performance.now();
    function animate(currentTime) {
        const elapsed = currentTime - startTime;
        const progress = Math.min(elapsed / options.animation.duration, 1);
        
        // Easing function
        const easeProgress = 1 - Math.pow(1 - progress, 3); // easeOutCubic
        currentScore = lerp(0, score, easeProgress);

        // Update chart data
        chart.data.datasets[0].data = [currentScore, 100 - currentScore];
        chart.data.datasets[0].backgroundColor = [
            getScoreColor(currentScore),
            options.colors.background
        ];
        chart.update('none'); // Update without animation

        // Draw additional elements
        drawGaugeElements(ctx, currentScore, options);

        if (progress < 1) {
            requestAnimationFrame(animate);
        }
    }

    requestAnimationFrame(animate);
}

// Helper function to draw additional gauge elements
function drawGaugeElements(ctx, score, options) {
    const width = ctx.canvas.width;
    const height = ctx.canvas.height;
    const centerX = width / 2;
    const centerY = height - 30;

    // Clear the bottom section
    ctx.clearRect(0, height - 60, width, 60);

    // Draw score
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.font = 'bold 24px Arial';
    ctx.fillStyle = getScoreColor(score);
    ctx.fillText(`${Math.round(score)}%`, centerX, centerY);

    // Draw subtitle
    ctx.font = '14px Arial';
    ctx.fillStyle = options.colors.subText;
    ctx.fillText(options.labels.subtitle, centerX, centerY + 25);

    // Draw min/max labels
    ctx.font = '12px Arial';
    ctx.fillStyle = options.colors.subText;
    ctx.textAlign = 'left';
    ctx.fillText(options.labels.minLabel, 20, centerY);
    ctx.textAlign = 'right';
    ctx.fillText(options.labels.maxLabel, width - 20, centerY);

    // Draw tick marks
    drawTicks(ctx, centerX, centerY - 60, options);
}

// Helper function to draw tick marks
function drawTicks(ctx, centerX, centerY, options) {
    const radius = 80;
    for (let i = 0; i <= 10; i++) {
        const angle = (Math.PI * (i / 10)) - (Math.PI / 2);
        const tickLength = i % 2 === 0 ? 10 : 5;
        const startX = centerX + (radius - tickLength) * Math.cos(angle);
        const startY = centerY + (radius - tickLength) * Math.sin(angle);
        const endX = centerX + radius * Math.cos(angle);
        const endY = centerY + radius * Math.sin(angle);

        ctx.beginPath();
        ctx.moveTo(startX, startY);
        ctx.lineTo(endX, endY);
        ctx.strokeStyle = options.colors.subText;
        ctx.lineWidth = i % 2 === 0 ? 2 : 1;
        ctx.stroke();
    }
}

function getScoreColor(score) {
    if (score >= 80) return 'rgb(34, 197, 94)';
    if (score >= 60) return 'rgb(234, 179, 8)';
    return 'rgb(239, 68, 68)';
}

function createFinancialMetricsChart(data) {
    const ctx = document.getElementById('financialMetricsChart').getContext('2d');
    ctx.canvas.style.height = '400px'; // Increased height
    
    // Enhanced metrics info with more detailed descriptions and color-coded ranges
    const metricsInfo = {
        'Profit Margin': {
            description: 'Shows how much profit is made from sales',
            formula: '(Net Profit ÷ Revenue) × 100%',
            goodRange: 'Generally, >10% is considered good',
            ranges: {
                poor: 5,
                fair: 10,
                good: 15,
                excellent: 20
            },
            unit: '%'
        },
        'Current Ratio': {
            description: 'Measures ability to pay short-term debts',
            formula: 'Current Assets ÷ Current Liabilities',
            goodRange: 'Ideally between 1.5 and 3.0',
            ranges: {
                poor: 1,
                fair: 1.5,
                good: 2,
                excellent: 3
            },
            unit: 'ratio'
        },
        'Quick Ratio': {
            description: 'Measures ability to pay immediate debts',
            formula: '(Current Assets - Inventory) ÷ Current Liabilities',
            goodRange: '>1.0 is considered good',
            ranges: {
                poor: 0.5,
                fair: 0.8,
                good: 1,
                excellent: 1.5
            },
            unit: 'ratio'
        },
        'Asset Turnover': {
            description: 'Shows how efficiently assets generate revenue',
            formula: 'Revenue ÷ Average Total Assets',
            goodRange: 'Higher ratio indicates better efficiency',
            ranges: {
                poor: 0.5,
                fair: 1,
                good: 1.5,
                excellent: 2
            },
            unit: 'ratio'
        },
        'Working Capital': {
            description: 'Shows available operating liquidity',
            formula: 'Current Assets - Current Liabilities',
            goodRange: 'Positive value indicates good short-term health',
            ranges: {
                poor: 0.5,
                fair: 1,
                good: 1.5,
                excellent: 2
            },
            unit: 'ratio'
        }
    };

    // Helper function to get color based on value and ranges
    const getMetricColor = (metric, value) => {
        const ranges = metricsInfo[metric].ranges;
        if (value >= ranges.excellent) return 'rgb(34, 197, 94)';
        if (value >= ranges.good) return 'rgb(59, 130, 246)';
        if (value >= ranges.fair) return 'rgb(234, 179, 8)';
        return 'rgb(239, 68, 68)';
    };

    new Chart(ctx, {
        type: 'radar',
        data: {
            labels: Object.keys(metricsInfo),
            datasets: [{
                label: 'Company Metrics',
                data: [
                    data.analysis.financial.profit_margin,
                    data.analysis.financial.current_ratio,
                    data.analysis.financial.quick_ratio,
                    data.analysis.financial.asset_turnover,
                    data.analysis.financial.working_capital_ratio
                ],
                backgroundColor: 'rgba(59, 130, 246, 0.2)',
                borderColor: 'rgb(59, 130, 246)',
                borderWidth: 2,
                pointBackgroundColor: ctx => {
                    const index = ctx.dataIndex;
                    const value = ctx.dataset.data[index];
                    const metric = Object.keys(metricsInfo)[index];
                    return getMetricColor(metric, value);
                },
                pointBorderColor: '#fff',
                pointHoverBackgroundColor: '#fff',
                pointHoverBorderColor: 'rgb(59, 130, 246)',
                pointRadius: 5,
                pointHoverRadius: 7
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                r: {
                    angleLines: {
                        display: true,
                        color: 'rgba(0, 0, 0, 0.1)'
                    },
                    grid: {
                        color: 'rgba(0, 0, 0, 0.1)',
                        circular: true
                    },
                    suggestedMin: 0,
                    pointLabels: {
                        font: {
                            size: 12,
                            weight: 'bold'
                        },
                        callback: function(value) {
                            return value.split(' ').join('\n');
                        }
                    },
                    ticks: {
                        backdropColor: 'rgba(255, 255, 255, 0.8)',
                        font: {
                            size: 10
                        }
                    }
                }
            },
            plugins: {
                legend: {
                    position: 'top',
                    labels: {
                        font: {
                            size: 12,
                            weight: 'bold'
                        },
                        usePointStyle: true,
                        padding: 20
                    }
                },
                tooltip: {
                    backgroundColor: 'rgba(255, 255, 255, 0.95)',
                    titleColor: '#1f2937',
                    bodyColor: '#4b5563',
                    borderColor: '#e5e7eb',
                    borderWidth: 1,
                    padding: 12,
                    callbacks: {
                        label: function(context) {
                            const metric = context.label;
                            const value = context.raw.toFixed(2);
                            const info = metricsInfo[metric];
                            const status = value >= info.ranges.excellent ? 'Excellent' :
                                         value >= info.ranges.good ? 'Good' :
                                         value >= info.ranges.fair ? 'Fair' : 'Needs Improvement';
                            
                            return [
                                `Value: ${value}${info.unit}`,
                                `Status: ${status}`,
                                `Description: ${info.description}`,
                                `Formula: ${info.formula}`,
                                `Target: ${info.goodRange}`
                            ];
                        }
                    }
                }
            }
        }
    });

    // Create an enhanced legend with explanations
    const legendDiv = document.createElement('div');
    legendDiv.className = 'mt-6 p-6 bg-gray-50 rounded-xl shadow-sm';
    legendDiv.innerHTML = `
        <h3 class="text-xl font-bold mb-4 text-gray-800">Financial Metrics Guide</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            ${Object.entries(metricsInfo).map(([metric, info]) => `
                <div class="bg-white p-4 rounded-lg shadow-sm">
                    <div class="flex items-center justify-between mb-2">
                        <h4 class="font-semibold text-gray-800">${metric}</h4>
                        <span class="px-2 py-1 bg-blue-100 text-blue-800 text-sm rounded-full">
                            ${info.unit}
                        </span>
                    </div>
                    <p class="text-sm mb-2">${info.description}</p>
                    <div class="text-sm text-gray-600">
                        <p class="mb-1"><span class="font-medium">Formula:</span> ${info.formula}</p>
                        <p><span class="font-medium">Target Range:</span> ${info.goodRange}</p>
                    </div>
                    <div class="mt-2 flex items-center space-x-2">
                        <span class="inline-block w-3 h-3 rounded-full bg-red-500"></span>
                        <span class="text-xs">Poor: <${info.ranges.fair}</span>
                        <span class="inline-block w-3 h-3 rounded-full bg-yellow-500"></span>
                        <span class="text-xs">Fair: >${info.ranges.fair}</span>
                        <span class="inline-block w-3 h-3 rounded-full bg-blue-500"></span>
                        <span class="text-xs">Good: >${info.ranges.good}</span>
                        <span class="inline-block w-3 h-3 rounded-full bg-green-500"></span>
                        <span class="text-xs">Excellent: >${info.ranges.excellent}</span>
                    </div>
                </div>
            `).join('')}
        </div>
    `;

    ctx.canvas.parentNode.insertAdjacentElement('afterend', legendDiv);
}

function createTrendAnalysisChart(data) {
    const ctx = document.getElementById('trendAnalysisChart').getContext('2d');
    ctx.canvas.style.height = '400px'; // Increased height
    
    const historicalData = data.analysis.growth.historical_data;
    
    // Enhanced growth rate calculations with additional metrics
    const growthRates = historicalData.slice(1).map((current, index) => {
        const previous = historicalData[index];
        return ((current - previous) / previous) * 100;
    });

    // Enhanced moving average calculation
    const movingAverageWindow = 3;
    const movingAverage = historicalData.map((_, index, array) => {
        if (index < movingAverageWindow - 1) return null;
        const slice = array.slice(index - movingAverageWindow + 1, index + 1);
        return slice.reduce((sum, value) => sum + value, 0) / movingAverageWindow;
    });

    // Enhanced gradient plugin
    const gradientPlugin = {
        id: 'gradientBackground',
        beforeDraw: (chart) => {
            const ctx = chart.ctx;
            const chartArea = chart.chartArea;
            const gradient = ctx.createLinearGradient(0, chartArea.bottom, 0, chartArea.top);
            gradient.addColorStop(0, 'rgba(59, 130, 246, 0.1)');
            gradient.addColorStop(0.5, 'rgba(59, 130, 246, 0.05)');
            gradient.addColorStop(1, 'rgba(59, 130, 246, 0.02)');
            ctx.fillStyle = gradient;
            ctx.fillRect(chartArea.left, chartArea.top, chartArea.right - chartArea.left, chartArea.bottom - chartArea.top);
        }
    };

    // Enhanced annotation plugin
    const annotationPlugin = {
        id: 'customAnnotation',
        afterDraw: (chart) => {
            const ctx = chart.ctx;
            const lastValue = historicalData[historicalData.length - 1];
            const lastGrowth = growthRates[growthRates.length - 1];
            
            ctx.save();
            ctx.font = '12px Arial';
            ctx.fillStyle = lastGrowth >= 0 ? 'rgb(34, 197, 94)' : 'rgb(239, 68, 68)';
            ctx.textAlign = 'right';
            ctx.fillText(`Latest Growth: ${lastGrowth.toFixed(1)}%`, chart.width - 10, 20);
            ctx.restore();
        }
    };

    new Chart(ctx, {
        type: 'line',
        data: {
            labels: ['Year -5', 'Year -4', 'Year -3', 'Year -2', 'Year -1'],
            datasets: [
                {
                    label: 'Revenue',
                    data: historicalData,
                    borderColor: 'rgb(59, 130, 246)',
                    borderWidth: 3,
                    tension: 0.3,
                    fill: false,
                    order: 1
                },
                {
                    label: '3-Year Moving Average',
                    data: movingAverage,
                    borderColor: 'rgba(234, 88, 12, 0.8)',
                    borderWidth: 2,
                    borderDash: [6, 6],
                    tension: 0.3,
                    fill: false,
                    order: 2
                },
                {
                    label: 'YoY Growth Rate (%)',
                    data: [null, ...growthRates],
                    type: 'bar',
                    backgroundColor: ctx => {
                        const value = ctx.raw;
                        return value >= 0 ? 'rgba(34, 197, 94, 0.5)' : 'rgba(239, 68, 68, 0.5)';
                    },
                    borderColor: ctx => {
                        const value = ctx.raw;
                        return value >= 0 ? 'rgba(34, 197, 94, 1)' : 'rgba(239, 68, 68, 1)';
                    },
                    borderWidth: 1,
                    yAxisID: 'growth',
                    order: 3
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            interaction: {
                mode: 'index',
                intersect: false
            },
            plugins: {
                tooltip: {
                    backgroundColor: 'rgba(255, 255, 255, 0.95)',
                    titleColor: '#1f2937',
                    bodyColor: '#4b5563',
                    borderColor: '#e5e7eb',
                    borderWidth: 1,
                    padding: 12,
                    callbacks: {
                        label: function(context) {
                            if (context.dataset.label === 'YoY Growth Rate (%)') {
                                const value = context.raw;
                                const color = value >= 0 ? '🟢' : '🔴';
                                return `${color} Growth: ${value?.toFixed(1)}%`;
                            }
                            return `${context.dataset.label}: ${formatIndianCurrency(context.raw)}`;
                        }
                    }
                },
                legend: {
                    position: 'top',
                    labels: {
                        usePointStyle: true,
                        padding: 20,
                        font: {
                            size: 12,
                            weight: 'bold'
                        }
                    }
                },
                title: {
                    display: true,
                    text: ['Revenue Trend Analysis', 'Year-over-Year Comparison'],
                    font: {
                        size: 16,
                        weight: 'bold'
                    },
                    padding: {
                        top: 10,
                        bottom: 30
                    }
                }
            },
            scales: {
                x: {
                    grid: {
                        display: false
                    },
                    ticks: {
                        font: {
                            size: 12,
                            weight: 'bold'
                        }
                    }
                },
                y: {
                    type: 'linear',
                    display: true,
                    position: 'left',
                    beginAtZero: true,
                    grid: {
                        borderDash: [2, 2]
                    },
                    ticks: {
                        callback: function(value) {
                            return formatIndianCurrency(value);
                        },
                        font: {
                            size: 11
                        }
                    }
                },
                growth: {
                    type: 'linear',
                    display: true,
                    position: 'right',
                    beginAtZero: true,
                    grid: {
                        drawOnChartArea: false
                    },
                    border: {
                        dash: [4, 4]
                    },
                    ticks: {
                        callback: function(value) {
                            return `${value}%`;
                        },
                        font: {
                            size: 11
                        },
                        color: (context) => {
                            const value = context.tick.value;
                            return value >= 0 ? 'rgb(34, 197, 94)' : 'rgb(239, 68, 68)';
                        }
                    }
                }
            },
            elements: {
                point: {
                    radius: 4,
                    hoverRadius: 6
                },
                line: {
                    tension: 0.3
                }
            },
            animation: {
                duration: 1500,
                easing: 'easeInOutQuart'
            }
        },
        plugins: [gradientPlugin, annotationPlugin]
    });

    // Add analysis summary below the chart
    const summaryDiv = document.createElement('div');
    summaryDiv.className = 'mt-6 p-6 bg-gray-50 rounded-xl shadow-sm';

    // Calculate key metrics
    const latestGrowth = growthRates[growthRates.length - 1];
    const averageGrowth = growthRates.reduce((sum, rate) => sum + rate, 0) / growthRates.length;
    const maxGrowth = Math.max(...growthRates);
    const minGrowth = Math.min(...growthRates);
    const growthTrend = latestGrowth > averageGrowth ? 'Improving' : 
                       latestGrowth < averageGrowth ? 'Declining' : 'Stable';

    summaryDiv.innerHTML = `
        <div class="mb-4">
            <h3 class="text-xl font-bold text-gray-800 mb-2">Growth Analysis Summary</h3>
            <p class="text-sm text-gray-600">Comprehensive analysis of revenue growth patterns</p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
            <div class="bg-white p-4 rounded-lg shadow-sm">
                <div class="text-sm text-gray-600 mb-1">Latest Growth</div>
                <div class="text-xl font-bold ${latestGrowth >= 0 ? 'text-green-600' : 'text-red-600'}">
                    ${latestGrowth.toFixed(1)}%
                </div>
            </div>
            <div class="bg-white p-4 rounded-lg shadow-sm">
                <div class="text-sm text-gray-600 mb-1">Average Growth</div>
                <div class="text-xl font-bold ${averageGrowth >= 0 ? 'text-green-600' : 'text-red-600'}">
                    ${averageGrowth.toFixed(1)}%
                </div>
            </div>
            <div class="bg-white p-4 rounded-lg shadow-sm">
                <div class="text-sm text-gray-600 mb-1">Growth Range</div>
                <div class="text-xl font-bold text-gray-800">
                    ${minGrowth.toFixed(1)}% to ${maxGrowth.toFixed(1)}%
                </div>
            </div>
            <div class="bg-white p-4 rounded-lg shadow-sm">
                <div class="text-sm text-gray-600 mb-1">Trend Direction</div>
                <div class="text-xl font-bold ${
                    growthTrend === 'Improving' ? 'text-green-600' : 
                    growthTrend === 'Declining' ? 'text-red-600' : 
                    'text-blue-600'
                }">
                    ${growthTrend}
                </div>
            </div>
        </div>

        <div class="bg-blue-50 p-4 rounded-lg">
            <div class="font-semibold text-blue-800 mb-2">Key Observations</div>
            <ul class="space-y-2 text-sm text-blue-700">
                <li>• ${
                    latestGrowth > averageGrowth ? 
                    'Recent growth exceeds historical average, indicating positive momentum.' :
                    latestGrowth < averageGrowth ?
                    'Recent growth below historical average, suggesting potential challenges.' :
                    'Growth remains consistent with historical patterns.'
                }</li>
                <li>• ${
                    maxGrowth - minGrowth > 10 ?
                    'High growth volatility indicates dynamic market conditions.' :
                    'Stable growth pattern suggests consistent market performance.'
                }</li>
                <li>• Moving average trend ${
                    movingAverage[movingAverage.length - 1] > movingAverage[movingAverage.length - 2] ?
                    'shows upward momentum, supporting positive outlook.' :
                    'indicates potential stabilization in growth rate.'
                }</li>
            </ul>
        </div>
    `;

    ctx.canvas.parentNode.insertAdjacentElement('afterend', summaryDiv);
}

// Helper function for currency formatting
function formatIndianCurrency(value) {
    return new Intl.NumberFormat('en-IN', {
        style: 'currency',
        currency: 'INR',
        maximumFractionDigits: 0,
        minimumFractionDigits: 0
    }).format(value || 0);
}

/**
 * Creates an enhanced risk radar chart visualization
 * @param {Object} data - Input data containing risk analysis metrics
 * @param {Object} data.risk_analysis - Risk analysis values
 * @param {number} data.risk_analysis.financial_risk - Financial risk score
 * @param {number} data.risk_analysis.market_risk - Market risk score
 * @param {number} data.risk_analysis.operational_risk - Operational risk score
 * @param {number} data.risk_analysis.regulatory_risk - Regulatory risk score
 */
 function createRiskRadarChart(data) {
    // Configuration constants
    const CONFIG = {
        CANVAS: {
            WIDTH: '100%',
            HEIGHT: '600px',
            MAX_WIDTH: '800px'
        },
        RISK_LEVELS: {
            VERY_LOW: 0.8,
            LOW: 1.3,
            MODERATE: 1.7,
            HIGH: 2.2
        },
        COLORS: {
            CURRENT: {
                border: 'rgb(239, 68, 68)',
                background: 'rgba(239, 68, 68, 0.25)'
            },
            INDUSTRY: {
                border: 'rgb(59, 130, 246)',
                background: 'rgba(59, 130, 246, 0.15)'
            },
            PREVIOUS: {
                border: 'rgb(168, 85, 247)',
                background: 'rgba(168, 85, 247, 0.15)'
            }
        },
        ZONES: [
            { threshold: 0.27, color: 'rgba(34, 197, 94, 0.15)' },  // Very Low
            { threshold: 0.43, color: 'rgba(34, 197, 94, 0.1)' },   // Low
            { threshold: 0.57, color: 'rgba(234, 179, 8, 0.1)' },   // Moderate
            { threshold: 0.73, color: 'rgba(234, 179, 8, 0.15)' },  // High
            { threshold: 1.00, color: 'rgba(239, 68, 68, 0.15)' }   // Very High
        ]
    };

    // Set up canvas
    const canvas = document.getElementById('riskRadarChart');
    setupCanvas(canvas, CONFIG.CANVAS);

    // Initialize data
    const riskData = data.risk_analysis;
    const industryAverages = getIndustryAverages();
    const previousPeriod = generatePreviousPeriodData(riskData);

    // Create and render chart
    new Chart(canvas.getContext('2d'), {
        type: 'radar',
        data: generateChartData(riskData, industryAverages, previousPeriod, CONFIG.COLORS),
        options: generateChartOptions(),
        plugins: [createRiskZonesPlugin(CONFIG.ZONES)]
    });
}

// Helper functions
function setupCanvas(canvas, config) {
    canvas.style.width = config.WIDTH;
    canvas.style.height = config.HEIGHT;
    canvas.style.maxWidth = config.MAX_WIDTH;
    canvas.style.margin = 'auto';
}

function getIndustryAverages() {
    return {
        financial_risk: 1.5,
        market_risk: 1.8,
        operational_risk: 1.6,
        regulatory_risk: 1.7
    };
}

function generatePreviousPeriodData(currentData) {
    const variance = 0.1; // 10% maximum variance
    return Object.entries(currentData).reduce((acc, [key, value]) => {
        acc[key] = value * (1 + (Math.random() * 2 * variance - variance));
        return acc;
    }, {});
}

function getRiskLevel(value) {
    const levels = [
        { threshold: 0.8, label: 'Very Low' },
        { threshold: 1.3, label: 'Low' },
        { threshold: 1.7, label: 'Moderate' },
        { threshold: 2.2, label: 'High' },
        { threshold: Infinity, label: 'Very High' }
    ];
    return levels.find(level => value <= level.threshold).label;
}

function generateChartData(currentData, industryData, previousData, colors) {
    const labels = ['Financial Risk', 'Market Risk', 'Operational Risk', 'Regulatory Risk'];
    return {
        labels,
        datasets: [
            {
                label: 'Current Risk Profile',
                data: labels.map(label => currentData[label.toLowerCase().replace(' ', '_')]),
                ...createDatasetStyle(colors.CURRENT, { borderWidth: 3, pointRadius: 6 })
            },
            {
                label: 'Industry Average',
                data: labels.map(label => industryData[label.toLowerCase().replace(' ', '_')]),
                ...createDatasetStyle(colors.INDUSTRY, { borderWidth: 2.5, pointRadius: 5, borderDash: [6, 6] })
            },
            {
                label: 'Previous Period',
                data: labels.map(label => previousData[label.toLowerCase().replace(' ', '_')]),
                ...createDatasetStyle(colors.PREVIOUS, { borderWidth: 2, pointRadius: 4, borderDash: [4, 4] })
            }
        ]
    };
}

function createDatasetStyle(colors, options = {}) {
    return {
        backgroundColor: colors.background,
        borderColor: colors.border,
        pointBackgroundColor: colors.border,
        pointBorderColor: '#fff',
        pointHoverBackgroundColor: '#fff',
        pointHoverBorderColor: colors.border,
        pointHoverRadius: options.pointRadius + 2,
        pointStyle: options.pointStyle || 'circle',
        ...options
    };
}

function createRiskZonesPlugin(zones) {
    return {
        id: 'riskZones',
        beforeDraw: (chart) => {
            const ctx = chart.ctx;
            const centerX = chart.scales.r.xCenter;
            const centerY = chart.scales.r.yCenter;
            const maxRadius = chart.scales.r.drawingArea;

            zones.forEach((zone, index) => {
                const currentRadius = maxRadius * zone.threshold;
                const previousRadius = index === 0 ? 0 : maxRadius * zones[index - 1].threshold;

                const gradient = ctx.createRadialGradient(
                    centerX, centerY, previousRadius,
                    centerX, centerY, currentRadius
                );
                gradient.addColorStop(0, zone.color);
                gradient.addColorStop(1, zones[Math.min(index + 1, zones.length - 1)].color);
                
                ctx.beginPath();
                ctx.arc(centerX, centerY, currentRadius, 0, Math.PI * 2);
                if (index > 0) {
                    ctx.arc(centerX, centerY, previousRadius, Math.PI * 2, 0, true);
                }
                ctx.fillStyle = gradient;
                ctx.fill();
            });
        }
    };
}

function generateChartOptions() {
    return {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: createLegendOptions(),
            title: createTitleOptions(),
            tooltip: createTooltipOptions()
        },
        scales: {
            r: createRadialScaleOptions()
        },
        elements: {
            line: { tension: 0.2 }
        },
        animation: {
            duration: 1500,
            easing: 'easeInOutQuart'
        }
    };
}

function createLegendOptions() {
    return {
        position: 'top',
        labels: {
            usePointStyle: true,
            padding: 20,
            font: {
                size: 14,
                family: "'Inter', sans-serif"
            }
        }
    };
}

function createTitleOptions() {
    return {
        display: true,
        text: ['Risk Analysis Dashboard', 'Comparative View'],
        font: {
            size: 20,
            weight: 'bold',
            family: "'Inter', sans-serif"
        },
        padding: { top: 20, bottom: 40 },
        color: '#1f2937'
    };
}

function createTooltipOptions() {
    return {
        backgroundColor: 'rgba(255, 255, 255, 0.95)',
        titleColor: '#1f2937',
        bodyColor: '#4b5563',
        borderColor: '#e5e7eb',
        borderWidth: 1,
        padding: 15,
        boxPadding: 8,
        usePointStyle: true,
        titleFont: { size: 14 },
        bodyFont: { size: 13 },
        callbacks: {
            label: function(context) {
                const value = context.raw;
                const riskLevel = getRiskLevel(value);
                return `${context.dataset.label}: ${value.toFixed(2)} (${riskLevel} Risk)`;
            }
        }
    };
}

function createRadialScaleOptions() {
    return {
        min: 0,
        max: 3,
        beginAtZero: true,
        angleLines: {
            display: true,
            color: 'rgba(0, 0, 0, 0.1)',
            lineWidth: 1.5
        },
        grid: {
            color: 'rgba(0, 0, 0, 0.1)',
            circular: true,
            lineWidth: 1.5
        },
        pointLabels: {
            font: {
                size: 15,
                weight: '600',
                family: "'Inter', sans-serif"
            },
            padding: 10,
            callback: value => value.split(' ').join('\n')
        },
        ticks: {
            backdropColor: 'rgba(255, 255, 255, 0.9)',
            z: 1,
            stepSize: 0.6,
            font: { size: 12 },
            callback: value => {
                const labels = ['Very Low', 'Low', 'Moderate', 'High', 'Very High'];
                return labels[Math.floor(value / 0.6)] || '';
            }
        }
    };
}
// Results Display Functions

/**
 * Displays financial metrics in a formatted card layout
 * @param {Object} data - Input data containing financial analysis
 */
 function displayFinancialMetrics(data) {
    const metricsContainer = document.getElementById('financialMetrics');
    
    if (!metricsContainer) {
        console.error('Financial metrics container not found');
        return;
    }

    const financial = data.analysis.financial;

    // Define metrics with descriptions and thresholds for color coding
    const metrics = [
        {
            label: 'Profit Margin',
            value: formatPercentage(financial.profit_margin),
            description: 'Net income as a percentage of revenue',
            threshold: { good: 0.2, warning: 0.1 }  // 20% good, 10% warning
        },
        {
            label: 'Current Ratio',
            value: financial.current_ratio.toFixed(2),
            description: 'Ability to pay short-term obligations',
            threshold: { good: 2, warning: 1.5 }
        },
        {
            label: 'Quick Ratio',
            value: financial.quick_ratio.toFixed(2),
            description: 'Immediate ability to pay short-term obligations',
            threshold: { good: 1.5, warning: 1 }
        },
        {
            label: 'Working Capital',
            value: formatIndianCurrency(financial.working_capital),
            description: 'Available funds for day-to-day operations',
            threshold: { good: 1000000, warning: 500000 }
        },
        {
            label: 'Z-Score',
            value: financial.z_score.toFixed(2),
            description: 'Probability of financial distress',
            threshold: { good: 3, warning: 1.8 }
        }
    ];

    // Get status color based on value and thresholds
    function getStatusColor(metric, value) {
        const numValue = parseFloat(value.replace(/[^0-9.-]+/g, ""));
        if (numValue >= metric.threshold.good) return 'text-green-600';
        if (numValue >= metric.threshold.warning) return 'text-yellow-600';
        return 'text-red-600';
    }

    // Generate HTML for the metrics
    metricsContainer.innerHTML = metrics.map(metric => `
        <div class="metric-card p-4 bg-white rounded-lg shadow-sm hover:shadow-md transition-shadow duration-200">
            <div class="flex justify-between items-center mb-2">
                <div class="flex flex-col">
                    <span class="text-sm font-medium text-gray-600">${metric.label}</span>
                    <span class="text-xs text-gray-400">${metric.description}</span>
                </div>
                <span class="text-sm font-bold ${getStatusColor(metric, metric.value)}">
                    ${metric.value}
                </span>
            </div>
            <div class="w-full bg-gray-200 h-1 rounded-full overflow-hidden">
                <div class="bg-blue-500 h-full" style="width: ${getProgressWidth(metric.value)}%"></div>
            </div>
        </div>
    `).join('');

    // Add event listeners for interactivity
    addMetricCardListeners();
}

/**
 * Calculate progress bar width based on value
 * @param {string} value - The metric value
 * @returns {number} - Width percentage for progress bar
 */
function getProgressWidth(value) {
    const numValue = parseFloat(value.replace(/[^0-9.-]+/g, ""));
    // Normalize to percentage between 0-100
    return Math.min(Math.max((numValue * 100) / 3, 0), 100);
}

/**
 * Add event listeners to metric cards for interactivity
 */
function addMetricCardListeners() {
    document.querySelectorAll('.metric-card').forEach(card => {
        card.addEventListener('mouseenter', () => {
            card.classList.add('transform', 'scale-105');
        });
        card.addEventListener('mouseleave', () => {
            card.classList.remove('transform', 'scale-105');
        });
    });
}


function displayGrowthMetrics(data) {
    const metricsContainer = document.getElementById('growthMetrics');
    const growth = data.analysis.growth;
    
    // Helper function to determine trend color and icon
    const getTrendInfo = (trend) => {
        const configs = {
            'Positive': { color: 'text-green-600', icon: '↑' },
            'Negative': { color: 'text-red-600', icon: '↓' },
            'Neutral': { color: 'text-blue-600', icon: '→' }
        };
        // Default to neutral if trend doesn't match
        const trendLower = trend.toLowerCase();
        const key = trendLower.includes('positive') ? 'Positive' 
                   : trendLower.includes('negative') ? 'Negative' 
                   : 'Neutral';
        return configs[key];
    };

    const trendInfo = getTrendInfo(growth.growth_trend);
    
    metricsContainer.innerHTML = `
        <div class="bg-white rounded-lg shadow-lg p-6 hover:shadow-xl transition-shadow duration-300">
            <div class="flex items-center justify-between mb-4">
                <h4 class="font-semibold text-gray-800 text-lg">Growth Statistics</h4>
                <div class="px-3 py-1 rounded-full bg-gray-100">
                    <span class="text-sm font-medium ${trendInfo.color}">
                        ${trendInfo.icon} Growth Trend
                    </span>
                </div>
            </div>

            <div class="space-y-4">
                <!-- Average Growth Rate -->
                <div class="transform hover:scale-102 transition-transform duration-200">
                    <div class="bg-gray-50 rounded-lg p-4">
                        <div class="flex justify-between items-center">
                            <div>
                                <span class="text-sm text-gray-600">Average Growth Rate</span>
                                <div class="mt-1">
                                    <span class="text-xl font-bold ${growth.avg_growth_rate >= 0 ? 'text-green-600' : 'text-red-600'}">
                                        ${formatPercentage(growth.avg_growth_rate)}
                                    </span>
                                </div>
                            </div>
                            <div class="text-2xl ${growth.avg_growth_rate >= 0 ? 'text-green-600' : 'text-red-600'}">
                                ${growth.avg_growth_rate >= 0 ? '↗' : '↘'}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- CAGR -->
                <div class="transform hover:scale-102 transition-transform duration-200">
                    <div class="bg-gray-50 rounded-lg p-4">
                        <div class="flex justify-between items-center">
                            <div>
                                <span class="text-sm text-gray-600">CAGR</span>
                                <div class="mt-1">
                                    <span class="text-xl font-bold ${growth.cagr >= 0 ? 'text-green-600' : 'text-red-600'}">
                                        ${formatPercentage(growth.cagr)}
                                    </span>
                                </div>
                            </div>
                            <div class="text-2xl ${growth.cagr >= 0 ? 'text-green-600' : 'text-red-600'}">
                                ${growth.cagr >= 0 ? '↗' : '↘'}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Growth Trend -->
                <div class="transform hover:scale-102 transition-transform duration-200">
                    <div class="bg-gray-50 rounded-lg p-4">
                        <div class="flex justify-between items-center">
                            <div>
                                <span class="text-sm text-gray-600">Growth Trend</span>
                                <div class="mt-1">
                                    <span class="text-xl font-medium ${trendInfo.color}">
                                        ${growth.growth_trend}
                                    </span>
                                </div>
                            </div>
                            <div class="text-2xl ${trendInfo.color}">
                                ${trendInfo.icon}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mt-4 pt-4 border-t border-gray-200">
                <div class="text-xs text-gray-500">
                    Last updated: ${new Date().toLocaleDateString()}
                </div>
            </div>
        </div>
    `;
}

// Helper function to format percentage
function formatPercentage(value) {
    if (typeof value !== 'number') return 'N/A';
    return `${(value * 100).toFixed(1)}%`;
}

function displayMarketMetrics(data) {
    const metricsContainer = document.getElementById('marketMetrics');
    const market = data.analysis.market;

    // Helper functions for trends and styles
    const getTrendInfo = (value, threshold = 0) => {
        const trends = {
            positive: { icon: '↗', color: 'text-green-600' },
            negative: { icon: '↘', color: 'text-red-600' },
            neutral: { icon: '→', color: 'text-blue-600' }
        };
        return value > threshold ? trends.positive : 
               value < threshold ? trends.negative : 
               trends.neutral;
    };

    const getCompetitiveStyle = (position) => {
        const styles = {
            'Leader': 'bg-green-100 text-green-800',
            'Strong': 'bg-blue-100 text-blue-800',
            'Average': 'bg-yellow-100 text-yellow-800',
            'Weak': 'bg-red-100 text-red-800'
        };
        return styles[position] || 'bg-gray-100 text-gray-800';
    };

    // Insert the metrics content
    metricsContainer.innerHTML = `
        <!-- Left Column -->
        <div class="space-y-6">
            <!-- Market Share Card -->
            <div class="bg-gray-50 rounded-xl p-6 hover:bg-gray-100 transition-colors duration-200">
                <div class="flex items-center justify-between mb-4">
                    <div>
                        <span class="text-lg font-medium text-gray-600">Market Share</span>
                        <p class="text-sm text-gray-500 mt-1">Year-to-Date Performance</p>
                    </div>
                    <span class="text-sm px-3 py-1 bg-gray-200 rounded-full">YTD</span>
                </div>
                <div class="flex items-end justify-between mb-3">
                    <span class="text-3xl font-bold ${getTrendInfo(market.market_share, 15).color}">
                        ${formatPercentage(market.market_share)}
                    </span>
                    <span class="text-2xl ${getTrendInfo(market.market_share, 15).color}">
                        ${getTrendInfo(market.market_share, 15).icon}
                    </span>
                </div>
                <div class="mt-4">
                    <div class="flex justify-between text-sm mb-2">
                        <span>Progress to Goal</span>
                        <span>Target: 25%</span>
                    </div>
                    <div class="h-2 bg-gray-200 rounded-full overflow-hidden">
                        <div class="h-full bg-blue-600 rounded-full transition-all duration-500" 
                             style="width: ${Math.min(market.market_share, 100)}%">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Employee Productivity Card -->
            <div class="bg-gray-50 rounded-xl p-6 hover:bg-gray-100 transition-colors duration-200">
                <div class="flex items-center justify-between mb-4">
                    <div>
                        <span class="text-lg font-medium text-gray-600">Employee Productivity</span>
                        <p class="text-sm text-gray-500 mt-1">Revenue Per Employee</p>
                    </div>
                    <div class="px-3 py-1 bg-gray-200 rounded-full">
                        <span class="text-sm">Per Employee</span>
                    </div>
                </div>
                <div class="flex items-end justify-between mb-3">
                    <span class="text-3xl font-bold ${getTrendInfo(market.employee_productivity, 500000).color}">
                        ${formatIndianCurrency(market.employee_productivity)}
                    </span>
                    <span class="text-2xl ${getTrendInfo(market.employee_productivity, 500000).color}">
                        ${getTrendInfo(market.employee_productivity, 500000).icon}
                    </span>
                </div>
                <div class="mt-4 pt-4 border-t border-gray-200">
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-gray-600">vs Industry Average</span>
                        <span class="text-sm font-medium ${getTrendInfo(market.employee_productivity - 600000).color}">
                            ${formatPercentage(market.employee_productivity / 600000 * 100 - 100)}
                        </span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Column -->
        <div class="space-y-6">
            <!-- Competitive Position Card -->
            <div class="bg-gray-50 rounded-xl p-6 hover:bg-gray-100 transition-colors duration-200">
                <div class="flex items-center justify-between mb-4">
                    <div>
                        <span class="text-lg font-medium text-gray-600">Competitive Position</span>
                        <p class="text-sm text-gray-500 mt-1">Market Standing</p>
                    </div>
                    <span class="text-sm px-3 py-1 bg-gray-200 rounded-full">Current</span>
                </div>
                <div class="flex items-center justify-between mb-4">
                    <div>
                        <span class="px-4 py-2 rounded-full text-base font-semibold ${getCompetitiveStyle(market.competitive_position)}">
                            ${market.competitive_position}
                        </span>
                        <p class="text-sm text-gray-500 mt-3">
                            Industry Rank: ${market.competitive_position === 'Leader' ? '#1' : 
                                          market.competitive_position === 'Strong' ? 'Top 5' : 
                                          market.competitive_position === 'Average' ? 'Top 10' : 'Below 10'}
                        </p>
                    </div>
                    <span class="text-4xl opacity-50">🏆</span>
                </div>
                <div class="mt-4 pt-4 border-t border-gray-200">
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-gray-600">Market Impact Score</span>
                        <span class="text-sm font-medium">8.5/10</span>
                    </div>
                </div>
            </div>

            <!-- Market Insights Card -->
            <div class="bg-blue-50 rounded-xl p-6">
                <div class="flex items-center justify-between mb-4">
                    <div>
                        <span class="text-lg font-medium text-blue-800">Key Insights</span>
                        <p class="text-sm text-blue-600 mt-1">Market Analysis</p>
                    </div>
                </div>
                <div class="space-y-3">
                    <div class="text-sm text-blue-700">
                        ${market.market_share > 20 
                            ? "Strong market presence with leading share." 
                            : market.market_share > 10 
                            ? "Growing presence with expansion potential." 
                            : "Emerging player with growth opportunities."}
                    </div>
                    <div class="text-sm text-blue-700">
                        ${market.competitive_position === 'Leader' 
                            ? "Maintained market leadership position." 
                            : market.competitive_position === 'Strong' 
                            ? "Strong competitive advantage established." 
                            : "Stable market position with room for growth."}
                    </div>
                </div>
            </div>
        </div>
    `;
}

// Helper functions for formatting
function formatPercentage(value) {
    return `${(value || 0).toFixed(1)}%`;
}

function formatIndianCurrency(value) {
    return new Intl.NumberFormat('en-IN', {
        style: 'currency',
        currency: 'INR',
        maximumFractionDigits: 0,
        minimumFractionDigits: 0
    }).format(value || 0);
}

function displaySWOTAnalysis(data) {
    const swot = data.swot_analysis;
    
    ['Strengths', 'Weaknesses', 'Opportunities', 'Threats'].forEach(category => {
        const container = document.getElementById(`swot${category}`);
        const items = swot[category.toLowerCase()];
        
        container.innerHTML = items.map(item => `
            <div class="p-3 bg-white rounded-lg shadow-sm">
                <div class="font-medium text-gray-800 mb-1">${item.category}</div>
                <p class="text-sm text-gray-600">${item.description}</p>
                <div class="mt-2 text-xs font-medium ${getImpactColor(item.impact)}">
                    ${item.impact} Impact
                </div>
            </div>
        `).join('');
    });
}

function getImpactColor(impact) {
    switch (impact.toLowerCase()) {
        case 'high':
            return 'text-red-600';
        case 'medium':
            return 'text-yellow-600';
        default:
            return 'text-green-600';
    }
}

function displayRecommendations(data) {
    const container = document.getElementById('recommendations');
    
    container.innerHTML = data.recommendations.map(rec => `
        <div class="bg-white p-4 rounded-lg shadow-sm hover:shadow-md transition-shadow">
            <div class="flex items-center justify-between mb-3">
                <h4 class="font-semibold text-gray-800">${rec.category}</h4>
                <span class="px-2 py-1 text-xs rounded-full ${getPriorityColor(rec.priority)}">
                    ${rec.priority} Priority
                </span>
            </div>
            <p class="text-gray-600 mb-3">${rec.description}</p>
            <div class="space-y-2">
                ${rec.actions.map(action => `
                    <div class="flex items-center text-sm text-gray-600">
                        <svg class="w-4 h-4 mr-2 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                        </svg>
                        ${action}
                    </div>
                `).join('')}
            </div>
        </div>
    `).join('');
}

function getPriorityColor(priority) {
    switch (priority.toLowerCase()) {
        case 'high':
            return 'bg-red-100 text-red-800';
        case 'medium':
            return 'bg-yellow-100 text-yellow-800';
        default:
            return 'bg-green-100 text-green-800';
    }
}

// Constants for status and risk levels
const STATUS_TYPES = {
    REQUIRED: 'required',
    RECOMMENDED: 'recommended',
    COMPLIANT: 'compliant',
    IN_PROGRESS: 'in_progress',
    NOT_APPLICABLE: 'not_applicable'
};

const RISK_LEVELS = {
    HIGH: 'high',
    MEDIUM: 'medium',
    LOW: 'low'
};

// Main display function with enhanced features
function displayComplianceStatus(data) {
    const container = document.getElementById('complianceStatus');
    const stats = calculateComplianceStats(data.compliance_status);
    
    container.innerHTML = `
        ${renderComplianceOverview(stats)}
        ${renderFilters()}
        <div id="complianceItems" class="space-y-4 mt-4">
            ${renderComplianceItems(data.compliance_status)}
        </div>
    `;

    // Add event listeners after rendering
    setupEventListeners();
}

// Calculate compliance statistics
function calculateComplianceStats(items) {
    return items.reduce((acc, item) => {
        acc.total++;
        acc[item.status.toLowerCase()]++;
        acc.riskLevels[item.risk_level.toLowerCase()]++;
        return acc;
    }, {
        total: 0,
        compliant: 0,
        required: 0,
        recommended: 0,
        in_progress: 0,
        not_applicable: 0,
        riskLevels: { high: 0, medium: 0, low: 0 }
    });
}

// Render overview section with statistics
function renderComplianceOverview(stats) {
    const complianceRate = ((stats.compliant / stats.total) * 100).toFixed(1);
    
    return `
        <div class="bg-white p-6 rounded-lg shadow-sm mb-6">
            <h3 class="text-xl font-bold text-gray-800 mb-4">Compliance Overview</h3>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="p-4 bg-green-50 rounded-lg">
                    <div class="text-2xl font-bold text-green-700">${complianceRate}%</div>
                    <div class="text-sm text-green-600">Overall Compliance</div>
                </div>
                <div class="p-4 bg-red-50 rounded-lg">
                    <div class="text-2xl font-bold text-red-700">${stats.riskLevels.high}</div>
                    <div class="text-sm text-red-600">High Risk Items</div>
                </div>
                <div class="p-4 bg-yellow-50 rounded-lg">
                    <div class="text-2xl font-bold text-yellow-700">${stats.required}</div>
                    <div class="text-sm text-yellow-600">Required Actions</div>
                </div>
                <div class="p-4 bg-blue-50 rounded-lg">
                    <div class="text-2xl font-bold text-blue-700">${stats.total}</div>
                    <div class="text-sm text-blue-600">Total Requirements</div>
                </div>
            </div>
        </div>
    `;
}

// Render filter controls
function renderFilters() {
    return `
        <div class="bg-white p-4 rounded-lg shadow-sm mb-4">
            <div class="flex flex-wrap gap-4">
                <select id="statusFilter" class="px-3 py-2 border rounded-md text-sm">
                    <option value="">All Statuses</option>
                    ${Object.values(STATUS_TYPES).map(status => 
                        `<option value="${status}">${capitalizeFirst(status)}</option>`
                    ).join('')}
                </select>
                <select id="riskFilter" class="px-3 py-2 border rounded-md text-sm">
                    <option value="">All Risk Levels</option>
                    ${Object.values(RISK_LEVELS).map(risk => 
                        `<option value="${risk}">${capitalizeFirst(risk)}</option>`
                    ).join('')}
                </select>
                <input 
                    type="text" 
                    id="searchInput" 
                    placeholder="Search requirements..." 
                    class="px-3 py-2 border rounded-md text-sm flex-grow"
                >
            </div>
        </div>
    `;
}

// Render individual compliance items
function renderComplianceItems(items) {
    return items.map(item => `
        <div class="compliance-item border-l-4 ${getComplianceColor(item.risk_level)} p-4 bg-white rounded-lg shadow-sm"
             data-status="${item.status.toLowerCase()}"
             data-risk="${item.risk_level.toLowerCase()}">
            <div class="flex justify-between items-center mb-2">
                <div>
                    <h4 class="font-semibold text-gray-800">${item.requirement}</h4>
                    <div class="flex gap-2 mt-1">
                        <span class="px-2 py-1 text-xs rounded-full ${getStatusColor(item.status)}">
                            ${capitalizeFirst(item.status)}
                        </span>
                        <span class="px-2 py-1 text-xs rounded-full ${getRiskBadgeColor(item.risk_level)}">
                            ${capitalizeFirst(item.risk_level)} Risk
                        </span>
                    </div>
                </div>
                <button onclick="toggleDetails(this)" class="text-gray-500 hover:text-gray-700">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                    </svg>
                </button>
            </div>
            <div class="hidden details-panel">
                <div class="mt-3 p-3 bg-gray-50 rounded-md">
                    <p class="text-sm text-gray-600 mb-2">${item.recommendations}</p>
                    ${item.due_date ? `
                        <div class="text-xs text-gray-500 mt-2">
                            Due Date: ${new Date(item.due_date).toLocaleDateString()}
                        </div>
                    ` : ''}
                </div>
            </div>
        </div>
    `).join('');
}

// Enhanced color functions
function getComplianceColor(riskLevel) {
    switch (riskLevel.toLowerCase()) {
        case RISK_LEVELS.HIGH:
            return 'border-red-500';
        case RISK_LEVELS.MEDIUM:
            return 'border-yellow-500';
        case RISK_LEVELS.LOW:
            return 'border-green-500';
        default:
            return 'border-gray-500';
    }
}

function getStatusColor(status) {
    switch (status.toLowerCase()) {
        case STATUS_TYPES.REQUIRED:
            return 'bg-red-100 text-red-800';
        case STATUS_TYPES.RECOMMENDED:
            return 'bg-yellow-100 text-yellow-800';
        case STATUS_TYPES.COMPLIANT:
            return 'bg-green-100 text-green-800';
        case STATUS_TYPES.IN_PROGRESS:
            return 'bg-blue-100 text-blue-800';
        case STATUS_TYPES.NOT_APPLICABLE:
            return 'bg-gray-100 text-gray-800';
        default:
            return 'bg-gray-100 text-gray-800';
    }
}

function getRiskBadgeColor(riskLevel) {
    switch (riskLevel.toLowerCase()) {
        case RISK_LEVELS.HIGH:
            return 'bg-red-50 text-red-700';
        case RISK_LEVELS.MEDIUM:
            return 'bg-yellow-50 text-yellow-700';
        case RISK_LEVELS.LOW:
            return 'bg-green-50 text-green-700';
        default:
            return 'bg-gray-50 text-gray-700';
    }
}

// Utility functions
function capitalizeFirst(str) {
    return str.charAt(0).toUpperCase() + str.slice(1).toLowerCase();
}

function toggleDetails(button) {
    const detailsPanel = button.closest('.compliance-item').querySelector('.details-panel');
    detailsPanel.classList.toggle('hidden');
    button.querySelector('svg').style.transform = detailsPanel.classList.contains('hidden') ? '' : 'rotate(180deg)';
}

// Set up event listeners for filtering and search
function setupEventListeners() {
    const statusFilter = document.getElementById('statusFilter');
    const riskFilter = document.getElementById('riskFilter');
    const searchInput = document.getElementById('searchInput');

    function filterItems() {
        const selectedStatus = statusFilter.value.toLowerCase();
        const selectedRisk = riskFilter.value.toLowerCase();
        const searchTerm = searchInput.value.toLowerCase();

        document.querySelectorAll('.compliance-item').forEach(item => {
            const matchStatus = !selectedStatus || item.dataset.status === selectedStatus;
            const matchRisk = !selectedRisk || item.dataset.risk === selectedRisk;
            const matchSearch = !searchTerm || 
                item.textContent.toLowerCase().includes(searchTerm);

            item.style.display = matchStatus && matchRisk && matchSearch ? 'block' : 'none';
        });
    }

    statusFilter.addEventListener('change', filterItems);
    riskFilter.addEventListener('change', filterItems);
    searchInput.addEventListener('input', filterItems);
}

// Export Functions
async function exportToPDF() {
    showNotification('Preparing PDF export...');
    
    const element = document.getElementById('results');
    const opt = {
        margin: 1,
        filename: 'business_dna_analysis.pdf',
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2 },
        jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' }
    };

    try {
        await html2pdf().set(opt).from(element).save();
        showNotification('PDF exported successfully');
    } catch (error) {
        showNotification('Failed to export PDF', 'error');
        console.error('PDF Export Error:', error);
    }
}


function exportToExcel() {
    showNotification('Preparing Excel export...');
    
    try {
        const data = collectExcelData();
        const wb = XLSX.utils.book_new();
        
        // Financial Metrics Sheet
        const wsFinancial = XLSX.utils.json_to_sheet(data.financial);
        XLSX.utils.book_append_sheet(wb, wsFinancial, "Financial Metrics");
        
        // Growth Metrics Sheet
        const wsGrowth = XLSX.utils.json_to_sheet(data.growth);
        XLSX.utils.book_append_sheet(wb, wsGrowth, "Growth Analysis");
        
        // Market Position Sheet
        const wsMarket = XLSX.utils.json_to_sheet(data.market);
        XLSX.utils.book_append_sheet(wb, wsMarket, "Market Position");
        
        // Recommendations Sheet
        const wsRecommendations = XLSX.utils.json_to_sheet(data.recommendations);
        XLSX.utils.book_append_sheet(wb, wsRecommendations, "Recommendations");
        
        XLSX.writeFile(wb, "business_dna_analysis.xlsx");
        showNotification('Excel file exported successfully');
    } catch (error) {
        showNotification('Failed to export Excel file', 'error');
        console.error('Excel Export Error:', error);
    }
}

function collectExcelData() {
    return {
        financial: [
            {
                metric: 'Profit Margin',
                value: latestData.analysis.financial.profit_margin + '%'
            },
            {
                metric: 'Current Ratio',
                value: latestData.analysis.financial.current_ratio.toFixed(2)
            },
            {
                metric: 'Quick Ratio',
                value: latestData.analysis.financial.quick_ratio.toFixed(2)
            },
            {
                metric: 'Working Capital',
                value: formatIndianCurrency(latestData.analysis.financial.working_capital)
            }
        ],
        growth: [
            {
                metric: 'Average Growth Rate',
                value: latestData.analysis.growth.avg_growth_rate + '%'
            },
            {
                metric: 'CAGR',
                value: latestData.analysis.growth.cagr + '%'
            },
            {
                metric: 'Growth Trend',
                value: latestData.analysis.growth.growth_trend
            }
        ],
        market: [
            {
                metric: 'Market Share',
                value: latestData.analysis.market.market_share + '%'
            },
            {
                metric: 'Competitive Position',
                value: latestData.analysis.market.competitive_position
            },
            {
                metric: 'Employee Productivity',
                value: formatIndianCurrency(latestData.analysis.market.employee_productivity)
            }
        ],
        recommendations: latestData.recommendations.map(rec => ({
            category: rec.category,
            priority: rec.priority,
            description: rec.description
        }))
    };
}

// Form Submission Handler
let latestData = null; // Store the latest analysis results

document.getElementById('analysisForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    showLoading();

    try {
        const formData = new FormData(e.target);
        const data = Object.fromEntries(formData.entries());
        
        // Validate form data
        validateFinancialData(data);
        validateHistoricalData(data);

        const response = await fetch('https://dna-backend-1091742458180.us-central1.run.app/analyze', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data)
        });

        if (!response.ok) {
            throw new Error('Analysis failed. Please check your input data.');
        }

        latestData = await response.json();

        // Show the results container
        const resultsContainer = document.getElementById('results');
        resultsContainer.classList.remove('hidden');

        // Display company name
        document.getElementById('companyName').textContent = data.company_name;

        // Create and display charts
        createPerformanceGauge(85); // Example score
        createFinancialMetricsChart(latestData);
        createTrendAnalysisChart(latestData);
        createRiskRadarChart(latestData);

        // Display metrics
        displayFinancialMetrics(latestData);
        displayGrowthMetrics(latestData);
        displayMarketMetrics(latestData);
        displaySWOTAnalysis(latestData);
        displayRecommendations(latestData);
        displayComplianceStatus(latestData);

        showNotification('Analysis completed successfully');
        
        // Smooth scroll to results
        resultsContainer.scrollIntoView({ 
            behavior: 'smooth',
            block: 'start'
        });

    } catch (error) {
        showNotification(error.message, 'error');
        console.error('Analysis Error:', error);
    } finally {
        hideLoading();
    }
});

// Initialize tooltips and other UI components
document.addEventListener('DOMContentLoaded', () => {
    // Initialize tooltip event listeners
    document.querySelectorAll('.tooltip').forEach(tooltip => {
        tooltip.addEventListener('mouseenter', () => {
            tooltip.querySelector('.tooltip-text').style.visibility = 'visible';
            tooltip.querySelector('.tooltip-text').style.opacity = '1';
        });
        
        tooltip.addEventListener('mouseleave', () => {
            tooltip.querySelector('.tooltip-text').style.visibility = 'hidden';
            tooltip.querySelector('.tooltip-text').style.opacity = '0';
        });
    });

    // Add input validation listeners
    document.querySelectorAll('input[type="number"]').forEach(input => {
        input.addEventListener('input', (e) => {
            if (e.target.value < 0) {
                e.target.value = 0;
            }
        });
    });
});
    </script>
</body>
</html>
