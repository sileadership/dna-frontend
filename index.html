<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business DNA Analyzer</title>
    <!-- External Libraries -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>

    <style>
        /* .loading {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        } */
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }

        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        @media print {
            .no-print {
                display: none;
            }
            .page-break {
                page-break-before: always;
            }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .slide-in {
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .custom-input {
            transition: all 0.3s ease;
        }

        .custom-input:focus {
            transform: scale(1.02);
        }

        .tooltip {
            position: relative;
            display: inline-block;
        }

        .tooltip .tooltip-text {
            visibility: hidden;
            width: 200px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        .hover-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .hover-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .metric-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border-radius: 8px;
            padding: 1rem;
            transition: all 0.3s ease;
        }

        .metric-card:hover {
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Progress Bar -->
    <div id="progressBar" class="fixed top-0 left-0 w-full h-1 bg-blue-200 hidden">
        <div class="h-full bg-blue-600 transition-all duration-300" style="width: 0%"></div>
    </div>

    <!-- Main Container -->
    <div class="container mx-auto px-4 py-8">
        <!-- Header Section -->
        <div class="text-center mb-12 slide-in">
            <h1 class="text-4xl font-bold text-gray-800 mb-4">Business DNA Analyzer</h1>
            <p class="text-xl text-gray-600">Comprehensive Analysis for Indian Businesses</p>
        </div>

        <!-- Main Form -->
        <div class="max-w-6xl mx-auto bg-white rounded-xl shadow-lg p-8 hover-card">
            <form id="analysisForm" class="space-y-8">
                <!-- Company Information -->
                <div class="bg-gray-50 p-6 rounded-lg fade-in">
                    <h2 class="text-2xl font-semibold text-gray-800 mb-6">Company Information</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Company Name</label>
                            <input type="text" name="company_name" required
                                class="custom-input w-full px-4 py-2 rounded-md border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                placeholder="Enter company name">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Industry</label>
                            <select name="industry" required
                                class="custom-input w-full px-4 py-2 rounded-md border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <option value="">Select Industry</option>
                                <option value="technology">Technology</option>
                                <option value="retail">Retail</option>
                                <option value="manufacturing">Manufacturing</option>
                                <option value="fmcg">FMCG</option>
                                <option value="healthcare">Healthcare</option>
                                <option value="financial">Financial Services</option>
                                <option value="education">Education</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Year Founded</label>
                            <input type="number" name="year_founded" required min="1900" max="2024"
                                class="custom-input w-full px-4 py-2 rounded-md border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                placeholder="e.g., 2010">
                        </div>
                    </div>
                </div>

                <!-- Financial Information -->
                <div class="bg-gray-50 p-6 rounded-lg fade-in">
                    <h2 class="text-2xl font-semibold text-gray-800 mb-6">Financial Information</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Annual Revenue (₹)</label>
                            <input type="number" name="revenue" required min="0"
                                class="custom-input w-full px-4 py-2 rounded-md border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                placeholder="e.g., 10000000">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Annual Profit (₹)</label>
                            <input type="number" name="profit" required
                                class="custom-input w-full px-4 py-2 rounded-md border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                placeholder="e.g., 2000000">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Annual Expenses (₹)</label>
                            <input type="number" name="expenses" required min="0"
                                class="custom-input w-full px-4 py-2 rounded-md border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                placeholder="e.g., 8000000">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Current Assets (₹)</label>
                            <input type="number" name="current_assets" required min="0"
                                class="custom-input w-full px-4 py-2 rounded-md border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                placeholder="e.g., 5000000">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Current Liabilities (₹)</label>
                            <input type="number" name="current_liabilities" required min="0"
                                class="custom-input w-full px-4 py-2 rounded-md border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                placeholder="e.g., 3000000">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Inventory Value (₹)</label>
                            <input type="number" name="inventory" required min="0"
                                class="custom-input w-full px-4 py-2 rounded-md border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                placeholder="e.g., 1500000">
                        </div>
                    </div>
                </div>

                <!-- Market Position -->
                <div class="bg-gray-50 p-6 rounded-lg fade-in">
                    <h2 class="text-2xl font-semibold text-gray-800 mb-6">Market Position</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Market Share (%)</label>
                            <input type="number" name="market_share" required min="0" max="100" step="0.01"
                                class="custom-input w-full px-4 py-2 rounded-md border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                placeholder="e.g., 15.5">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Number of Major Competitors</label>
                            <input type="number" name="competitors" required min="0"
                                class="custom-input w-full px-4 py-2 rounded-md border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                placeholder="e.g., 5">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Total Employees</label>
                            <input type="number" name="total_employees" required min="1"
                                class="custom-input w-full px-4 py-2 rounded-md border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                placeholder="e.g., 100">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">R&D Investment (₹)</label>
                            <input type="number" name="rd_investment" required min="0"
                                class="custom-input w-full px-4 py-2 rounded-md border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                placeholder="e.g., 1000000">
                        </div>
                    </div>
                </div>

                <!-- Historical Data -->
                <div class="bg-gray-50 p-6 rounded-lg fade-in">
                    <h2 class="text-2xl font-semibold text-gray-800 mb-6">Historical Data</h2>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Historical Revenue (Last 5 years, comma-separated, in ₹)
                        </label>
                        <input type="text" name="historical_revenue" required
                            class="custom-input w-full px-4 py-2 rounded-md border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                            placeholder="10000000,12000000,15000000,18000000,20000000">
                        <p class="mt-2 text-sm text-gray-500">Enter values from oldest to newest, separated by commas</p>
                    </div>
                </div>

                <!-- Submit Button -->
                <div class="flex justify-center">
                    <button type="submit"
                        class="px-8 py-3 bg-blue-600 text-white text-lg font-semibold rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-500 focus:ring-opacity-50 transition-colors transform hover:scale-105">
                        Analyze Business DNA
                    </button>
                </div>
            </form>
        </div>

        <!-- Results Section -->
        <div id="results" class="mt-12 hidden slide-in">
            <!-- Company Overview -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-8 hover-card">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">Company Overview</h2>
                    <span id="companyName" class="text-xl text-gray-600"></span>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="p-4 bg-gray-50 rounded-lg metric-card">
                        <h3 class="font-semibold text-gray-700 mb-2">Overall Performance</h3>
                        <div class="chart-container">
                            <canvas id="performanceGauge"></canvas>
                        </div>
                    </div>
                    <div class="md:col-span-2">
                        <div class="chart-container">
                            <canvas id="kpiComparisonChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Financial Analysis -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-8 hover-card">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">Financial Analysis</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="chart-container">
                        <canvas id="financialMetricsChart"></canvas>
                    </div>
                    <div id="financialMetrics" class="space-y-4">
                        <!-- Financial metrics will be inserted here -->
                    </div>
                </div>
            </div>

            <!-- Growth Analysis -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-8 hover-card">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">Growth Analysis</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="chart-container">
                        <canvas id="trendAnalysisChart"></canvas>
                    </div>
                    <div id="growthMetrics" class="space-y-4">
                        <!-- Growth metrics will be inserted here -->
                    </div>
                </div>
            </div>

            <!-- Risk Analysis -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-8 hover-card">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">Risk Analysis</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="chart-container">
                        <canvas id="riskRadarChart"></canvas>
                    </div>
                    <div id="riskMetrics" class="space-y-4">
                        <!-- Risk metrics will be inserted here -->
                    </div>
                </div>
            </div>

            <!-- Market Position -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-8 hover-card">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">Market Position</h2>
                <div id="marketMetrics" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Market metrics will be inserted here -->
                </div>
            </div>

            <!-- SWOT Analysis -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-8 hover-card">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">SWOT Analysis</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-green-50 p-4 rounded-lg metric-card">
                        <h3 class="font-semibold text-green-800 mb-3">Strengths</h3>
                        <div id="swotStrengths" class="space-y-2">
                            <!-- Strengths will be inserted here -->
                        </div>
                    </div>
                    <div class="bg-red-50 p-4 rounded-lg metric-card">
                        <h3 class="font-semibold text-red-800 mb-3">Weaknesses</h3>
                        <div id="swotWeaknesses" class="space-y-2">
                            <!-- Weaknesses will be inserted here -->
                        </div>
                    </div>
                    <div class="bg-blue-50 p-4 rounded-lg metric-card">
                        <h3 class="font-semibold text-blue-800 mb-3">Opportunities</h3>
                        <div id="swotOpportunities" class="space-y-2">
                            <!-- Opportunities will be inserted here -->
                        </div>
                    </div>
                    <div class="bg-yellow-50 p-4 rounded-lg metric-card">
                        <h3 class="font-semibold text-yellow-800 mb-3">Threats</h3>
                        <div id="swotThreats" class="space-y-2">
                            <!-- Threats will be inserted here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recommendations -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-8 hover-card">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">Strategic Recommendations</h2>
                <div id="recommendations" class="space-y-4">
                    <!-- Recommendations will be inserted here -->
                </div>
            </div>

            <!-- Compliance Status -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-8 hover-card">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">Compliance Status</h2>
                <div id="complianceStatus" class="space-y-4">
                    <!-- Compliance status will be inserted here -->
                </div>
            </div>

            <!-- Export Options -->
            <div class="flex justify-end space-x-4 mt-8">
                <button onclick="exportToPDF()" 
                    class="px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 focus:outline-none focus:ring-4 focus:ring-red-500 focus:ring-opacity-50 transition-colors transform hover:scale-105">
                    <span class="flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                        Export to PDF
                    </span>
                </button>
                <button onclick="exportToExcel()"
                    class="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 focus:outline-none focus:ring-4 focus:ring-green-500 focus:ring-opacity-50 transition-colors transform hover:scale-105">
                    <span class="flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                        Export to Excel
                    </span>
                </button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="mt-12 text-center text-gray-600">
        <p>© 2024 School of inspirational Leadership. All rights reserved.</p>
    </footer>

    <!-- Notification Component -->
    <div id="notification" class="fixed top-4 right-4 max-w-sm bg-white rounded-lg shadow-lg p-4 hidden transform transition-all duration-300">
        <div class="flex items-center">
            <div class="flex-shrink-0">
                <svg class="h-6 w-6 text-green-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
            </div>
            <div class="ml-3">
                <p id="notificationMessage" class="text-sm font-medium text-gray-900"></p>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading hidden">
        <div class="loading-spinner"></div>
    </div>

    <!-- JavaScript -->
    <script>
        // Chart.js Global Configuration
Chart.defaults.font.family = '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif';
Chart.defaults.color = '#4B5563';
Chart.defaults.plugins.tooltip.backgroundColor = 'rgba(0, 0, 0, 0.8)';
Chart.defaults.plugins.legend.position = 'bottom';

// Utility Functions
function formatIndianCurrency(amount) {
    return new Intl.NumberFormat('en-IN', {
        style: 'currency',
        currency: 'INR',
        maximumFractionDigits: 0
    }).format(amount);
}

function formatPercentage(value) {
    return new Intl.NumberFormat('en-IN', {
        style: 'percent',
        minimumFractionDigits: 1,
        maximumFractionDigits: 1
    }).format(value / 100);
}

function showNotification(message, type = 'success') {
    const notification = document.getElementById('notification');
    const notificationMessage = document.getElementById('notificationMessage');
    const icon = notification.querySelector('svg');
    
    notificationMessage.textContent = message;
    
    if (type === 'error') {
        icon.classList.remove('text-green-400');
        icon.classList.add('text-red-400');
        notification.classList.add('bg-red-50');
    } else {
        icon.classList.remove('text-red-400');
        icon.classList.add('text-green-400');
        notification.classList.remove('bg-red-50');
    }
    
    notification.classList.remove('hidden');
    
    setTimeout(() => {
        notification.classList.add('hidden');
    }, 3000);
}

function showLoading() {
    document.getElementById('loadingOverlay').classList.remove('hidden');
    document.getElementById('progressBar').classList.remove('hidden');
    simulateProgress();
}

function hideLoading() {
    document.getElementById('loadingOverlay').classList.add('hidden');
    document.getElementById('progressBar').classList.add('hidden');
    resetProgress();
}

function simulateProgress() {
    const progressBar = document.querySelector('#progressBar > div');
    let width = 0;
    const interval = setInterval(() => {
        if (width >= 90) {
            clearInterval(interval);
        } else {
            width += Math.random() * 30;
            progressBar.style.width = Math.min(width, 90) + '%';
        }
    }, 500);
}

function resetProgress() {
    const progressBar = document.querySelector('#progressBar > div');
    progressBar.style.width = '0%';
}

// Form Validation Functions
function validateFinancialData(data) {
    const revenue = parseFloat(data.revenue);
    const profit = parseFloat(data.profit);
    const expenses = parseFloat(data.expenses);
    
    if (revenue < profit) {
        throw new Error('Revenue cannot be less than profit');
    }
    
    if (revenue < expenses) {
        throw new Error('Revenue cannot be less than expenses');
    }
    
    if ((profit + expenses) > revenue) {
        throw new Error('Profit plus expenses cannot exceed revenue');
    }
    
    return true;
}

function validateHistoricalData(data) {
    const historicalRevenue = data.historical_revenue.split(',').map(Number);
    
    if (historicalRevenue.length !== 5) {
        throw new Error('Please provide exactly 5 years of historical revenue data');
    }
    
    if (historicalRevenue.some(isNaN)) {
        throw new Error('Historical revenue must contain valid numbers');
    }
    
    if (historicalRevenue.some(value => value < 0)) {
        throw new Error('Historical revenue cannot contain negative values');
    }
    
    return true;
}

// Chart Creation Functions
function createPerformanceGauge(score) {
    const ctx = document.getElementById('performanceGauge').getContext('2d');
    
    new Chart(ctx, {
        type: 'doughnut',
        data: {
            datasets: [{
                data: [score, 100 - score],
                backgroundColor: [
                    getScoreColor(score),
                    'rgb(229, 231, 235)'
                ],
                borderWidth: 0
            }]
        },
        options: {
            responsive: true,
            circumference: 180,
            rotation: 270,
            cutout: '80%',
            plugins: {
                tooltip: {
                    enabled: false
                },
                legend: {
                    display: false
                }
            }
        }
    });
    
    // Add score text
    const centerX = ctx.canvas.width / 2;
    const centerY = ctx.canvas.height - 30;
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.font = 'bold 24px Arial';
    ctx.fillStyle = getScoreColor(score);
    ctx.fillText(`${Math.round(score)}%`, centerX, centerY);
}

function getScoreColor(score) {
    if (score >= 80) return 'rgb(34, 197, 94)';
    if (score >= 60) return 'rgb(234, 179, 8)';
    return 'rgb(239, 68, 68)';
}

function createFinancialMetricsChart(data) {
    const ctx = document.getElementById('financialMetricsChart').getContext('2d');
    
    new Chart(ctx, {
        type: 'radar',
        data: {
            labels: [
                'Profit Margin',
                'Current Ratio',
                'Quick Ratio',
                'Asset Turnover',
                'Working Capital'
            ],
            datasets: [{
                label: 'Company Metrics',
                data: [
                    data.analysis.financial.profit_margin,
                    data.analysis.financial.current_ratio,
                    data.analysis.financial.quick_ratio,
                    data.analysis.financial.asset_turnover,
                    data.analysis.financial.working_capital_ratio
                ],
                backgroundColor: 'rgba(59, 130, 246, 0.2)',
                borderColor: 'rgb(59, 130, 246)',
                pointBackgroundColor: 'rgb(59, 130, 246)',
                pointBorderColor: '#fff',
                pointHoverBackgroundColor: '#fff',
                pointHoverBorderColor: 'rgb(59, 130, 246)'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                r: {
                    angleLines: {
                        display: true
                    },
                    suggestedMin: 0
                }
            }
        }
    });
}

function createTrendAnalysisChart(data) {
    const ctx = document.getElementById('trendAnalysisChart').getContext('2d');
    const historicalData = data.analysis.growth.historical_data;
    
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: ['Year -5', 'Year -4', 'Year -3', 'Year -2', 'Year -1'],
            datasets: [{
                label: 'Revenue Trend',
                data: historicalData,
                borderColor: 'rgb(59, 130, 246)',
                tension: 0.1,
                fill: false
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            return formatIndianCurrency(context.raw);
                        }
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        callback: function(value) {
                            return formatIndianCurrency(value);
                        }
                    }
                }
            }
        }
    });
}

function createRiskRadarChart(data) {
    const ctx = document.getElementById('riskRadarChart').getContext('2d');
    const riskData = data.risk_analysis;
    
    new Chart(ctx, {
        type: 'radar',
        data: {
            labels: ['Financial Risk', 'Market Risk', 'Operational Risk', 'Regulatory Risk'],
            datasets: [{
                label: 'Risk Profile',
                data: [
                    riskData.financial_risk,
                    riskData.market_risk,
                    riskData.operational_risk,
                    riskData.regulatory_risk
                ],
                backgroundColor: 'rgba(239, 68, 68, 0.2)',
                borderColor: 'rgb(239, 68, 68)',
                pointBackgroundColor: 'rgb(239, 68, 68)',
                pointBorderColor: '#fff',
                pointHoverBackgroundColor: '#fff',
                pointHoverBorderColor: 'rgb(239, 68, 68)'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                r: {
                    angleLines: {
                        display: true
                    },
                    suggestedMin: 0,
                    suggestedMax: 3
                }
            }
        }
    });
}

// Results Display Functions
function displayFinancialMetrics(data) {
    const metricsContainer = document.getElementById('financialMetrics');
    const financial = data.analysis.financial;
    
    const metrics = [
        { label: 'Profit Margin', value: formatPercentage(financial.profit_margin) },
        { label: 'Current Ratio', value: financial.current_ratio.toFixed(2) },
        { label: 'Quick Ratio', value: financial.quick_ratio.toFixed(2) },
        { label: 'Working Capital', value: formatIndianCurrency(financial.working_capital) },
        { label: 'Z-Score', value: financial.z_score.toFixed(2) }
    ];
    
    metricsContainer.innerHTML = metrics.map(metric => `
        <div class="metric-card">
            <div class="flex justify-between items-center">
                <span class="text-sm font-medium text-gray-600">${metric.label}</span>
                <span class="text-sm font-bold text-gray-900">${metric.value}</span>
            </div>
        </div>
    `).join('');
}

function displayGrowthMetrics(data) {
    const metricsContainer = document.getElementById('growthMetrics');
    const growth = data.analysis.growth;
    
    metricsContainer.innerHTML = `
        <div class="metric-card">
            <h4 class="font-semibold text-gray-800 mb-2">Growth Statistics</h4>
            <div class="space-y-2">
                <div class="flex justify-between">
                    <span class="text-sm text-gray-600">Average Growth Rate</span>
                    <span class="text-sm font-medium">${formatPercentage(growth.avg_growth_rate)}</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-sm text-gray-600">CAGR</span>
                    <span class="text-sm font-medium">${formatPercentage(growth.cagr)}</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-sm text-gray-600">Growth Trend</span>
                    <span class="text-sm font-medium">${growth.growth_trend}</span>
                </div>
            </div>
        </div>
    `;
}

function displayMarketMetrics(data) {
    const metricsContainer = document.getElementById('marketMetrics');
    const market = data.analysis.market;
    
    metricsContainer.innerHTML = `
        <div class="metric-card">
            <h4 class="font-semibold text-gray-800 mb-2">Market Position</h4>
            <div class="space-y-2">
                <div class="flex justify-between">
                    <span class="text-sm text-gray-600">Market Share</span>
                    <span class="text-sm font-medium">${formatPercentage(market.market_share)}</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-sm text-gray-600">Competitive Position</span>
                    <span class="text-sm font-medium">${market.competitive_position}</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-sm text-gray-600">Employee Productivity</span>
                    <span class="text-sm font-medium">${formatIndianCurrency(market.employee_productivity)}</span>
                </div>
            </div>
        </div>
    `;
}

// Enhanced analysis function with comprehensive business metrics evaluation
function analyzeSWOT(formData) {
    // Parse numerical values
    const revenue = parseFloat(formData.revenue);
    const profit = parseFloat(formData.profit);
    const expenses = parseFloat(formData.expenses);
    const marketShare = parseFloat(formData.market_share);
    const competitors = parseInt(formData.competitors);
    const currentAssets = parseFloat(formData.current_assets);
    const currentLiabilities = parseFloat(formData.current_liabilities);
    const totalEmployees = parseInt(formData.total_employees);
    const rdInvestment = parseFloat(formData.rd_investment);
    const inventory = parseFloat(formData.inventory);

    // Calculate key financial ratios
    const profitMargin = (profit / revenue) * 100;
    const currentRatio = currentAssets / currentLiabilities;
    const operatingExpenseRatio = (expenses / revenue) * 100;
    const revenuePerEmployee = revenue / totalEmployees;
    const rdRatio = (rdInvestment / revenue) * 100;

    const swotAnalysis = {
        strengths: [],
        weaknesses: [],
        opportunities: [],
        threats: []
    };

    // Analyze Strengths
    if (profitMargin > 15) {
        swotAnalysis.strengths.push({
            category: "Financial Performance",
            description: "Strong profit margins above industry average",
            impact: "High"
        });
    }

    if (marketShare > 20) {
        swotAnalysis.strengths.push({
            category: "Market Position",
            description: "Dominant market share in the industry",
            impact: "High"
        });
    }

    if (currentRatio > 2) {
        swotAnalysis.strengths.push({
            category: "Liquidity",
            description: "Excellent working capital management",
            impact: "Medium"
        });
    }

    // Analyze Weaknesses
    if (profitMargin < 10) {
        swotAnalysis.weaknesses.push({
            category: "Profitability",
            description: "Below-average profit margins indicating potential cost management issues",
            impact: "High"
        });
    }

    if (operatingExpenseRatio > 80) {
        swotAnalysis.weaknesses.push({
            category: "Cost Structure",
            description: "High operating expenses affecting overall profitability",
            impact: "High"
        });
    }

    if (currentRatio < 1.5) {
        swotAnalysis.weaknesses.push({
            category: "Working Capital",
            description: "Limited working capital might affect operational flexibility",
            impact: "Medium"
        });
    }

    if (rdRatio < 5) {
        swotAnalysis.weaknesses.push({
            category: "Innovation",
            description: "Low R&D investment compared to industry standards",
            impact: "Medium"
        });
    }

    // Analyze Opportunities
    if (marketShare < 50) {
        swotAnalysis.opportunities.push({
            category: "Market Expansion",
            description: "Potential to capture additional market share",
            impact: "High"
        });
    }

    if (rdInvestment > 0) {
        swotAnalysis.opportunities.push({
            category: "Innovation",
            description: "Potential for new product development and innovation",
            impact: "Medium"
        });
    }

    // Analyze Threats
    if (competitors > 5) {
        swotAnalysis.threats.push({
            category: "Market Competition",
            description: "High competition in the market may affect market share",
            impact: "High"
        });
    }

    if (currentRatio < 1) {
        swotAnalysis.threats.push({
            category: "Financial Risk",
            description: "Potential liquidity issues could affect business operations",
            impact: "High"
        });
    }

    if (operatingExpenseRatio > 70) {
        swotAnalysis.threats.push({
            category: "Cost Pressure",
            description: "Rising operational costs could impact future profitability",
            impact: "Medium"
        });
    }

    if (profitMargin < 5) {
        swotAnalysis.threats.push({
            category: "Financial Sustainability",
            description: "Low profit margins threaten long-term sustainability",
            impact: "High"
        });
    }

    // Historical Revenue Analysis
    try {
        const historicalRevenue = formData.historical_revenue.split(',').map(Number);
        const revenueGrowth = calculateRevenueGrowth(historicalRevenue);
        
        if (revenueGrowth < 0) {
            swotAnalysis.threats.push({
                category: "Revenue Trend",
                description: "Declining revenue growth indicates market challenges",
                impact: "High"
            });
        } else if (revenueGrowth < 5) {
            swotAnalysis.weaknesses.push({
                category: "Growth",
                description: "Slow revenue growth compared to industry average",
                impact: "Medium"
            });
        }
    } catch (error) {
        console.error("Error analyzing historical revenue:", error);
    }

    return { swot_analysis: swotAnalysis };
}

// Helper function to calculate revenue growth
function calculateRevenueGrowth(historicalRevenue) {
    if (historicalRevenue.length < 2) return 0;
    const oldest = historicalRevenue[0];
    const newest = historicalRevenue[historicalRevenue.length - 1];
    return ((newest - oldest) / oldest) * 100;
}

// Modified display function to handle empty categories better
function displaySWOTAnalysis(data) {
    const swotData = data.swot_analysis;
    
    ['Strengths', 'Weaknesses', 'Opportunities', 'Threats'].forEach(category => {
        const containerId = `swot${category}`;
        const container = document.getElementById(containerId);
        if (!container) return;

        const items = swotData[category.toLowerCase()];
        
        if (!items || items.length === 0) {
            container.innerHTML = `
                <div class="p-4 bg-gray-50 rounded-lg border border-gray-200">
                    <p class="text-sm text-gray-600">
                        Based on the current analysis, no significant ${category.toLowerCase()} 
                        have been identified. Consider providing more detailed business metrics 
                        for a more comprehensive analysis.
                    </p>
                </div>
            `;
            return;
        }

        container.innerHTML = items.map(item => `
            <div class="p-4 bg-white rounded-lg shadow-sm mb-3 border-l-4 ${getImpactBorderColor(item.impact)}">
                <div class="font-medium text-gray-800 mb-2">
                    ${item.category}
                </div>
                <p class="text-sm text-gray-600 mb-2">
                    ${item.description}
                </p>
                <div class="flex items-center mt-2">
                    <span class="px-2 py-1 text-xs rounded-full ${getImpactBadgeColor(item.impact)} font-medium">
                        ${item.impact} Impact
                    </span>
                </div>
            </div>
        `).join('');
    });
}

// Helper function for impact border colors
function getImpactBorderColor(impact) {
    const colors = {
        'High': 'border-red-500',
        'Medium': 'border-yellow-500',
        'Low': 'border-green-500'
    };
    return colors[impact] || 'border-gray-500';
}

// Helper function for impact badge colors
function getImpactBadgeColor(impact) {
    const colors = {
        'High': 'bg-red-100 text-red-800',
        'Medium': 'bg-yellow-100 text-yellow-800',
        'Low': 'bg-green-100 text-green-800'
    };
    return colors[impact] || 'bg-gray-100 text-gray-800';
}

function getImpactColor(impact) {
    switch (impact.toLowerCase()) {
        case 'high':
            return 'text-red-600';
        case 'medium':
            return 'text-yellow-600';
        default:
            return 'text-green-600';
    }
}

function displayRecommendations(data) {
    const container = document.getElementById('recommendations');
    
    container.innerHTML = data.recommendations.map(rec => `
        <div class="bg-white p-4 rounded-lg shadow-sm hover:shadow-md transition-shadow">
            <div class="flex items-center justify-between mb-3">
                <h4 class="font-semibold text-gray-800">${rec.category}</h4>
                <span class="px-2 py-1 text-xs rounded-full ${getPriorityColor(rec.priority)}">
                    ${rec.priority} Priority
                </span>
            </div>
            <p class="text-gray-600 mb-3">${rec.description}</p>
            <div class="space-y-2">
                ${rec.actions.map(action => `
                    <div class="flex items-center text-sm text-gray-600">
                        <svg class="w-4 h-4 mr-2 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                        </svg>
                        ${action}
                    </div>
                `).join('')}
            </div>
        </div>
    `).join('');
}

function getPriorityColor(priority) {
    switch (priority.toLowerCase()) {
        case 'high':
            return 'bg-red-100 text-red-800';
        case 'medium':
            return 'bg-yellow-100 text-yellow-800';
        default:
            return 'bg-green-100 text-green-800';
    }
}

function displayComplianceStatus(data) {
    const container = document.getElementById('complianceStatus');
    
    container.innerHTML = data.compliance_status.map(item => `
        <div class="border-l-4 ${getComplianceColor(item.risk_level)} p-4 bg-white rounded-lg shadow-sm">
            <div class="flex justify-between items-center mb-2">
                <h4 class="font-semibold text-gray-800">${item.requirement}</h4>
                <span class="px-2 py-1 text-xs rounded-full ${getStatusColor(item.status)}">
                    ${item.status}
                </span>
            </div>
            <p class="text-sm text-gray-600">${item.recommendations}</p>
        </div>
    `).join('');
}

function getComplianceColor(riskLevel) {
    switch (riskLevel.toLowerCase()) {
        case 'high':
            return 'border-red-500';
        case 'medium':
            return 'border-yellow-500';
        default:
            return 'border-green-500';
    }
}

function getStatusColor(status) {
    switch (status.toLowerCase()) {
        case 'required':
            return 'bg-red-100 text-red-800';
        case 'recommended':
            return 'bg-yellow-100 text-yellow-800';
        case 'compliant':
            return 'bg-green-100 text-green-800';
        default:
            return 'bg-gray-100 text-gray-800';
    }
}

// Export Functions
async function exportToPDF() {
    showNotification('Preparing PDF export...');
    
    const element = document.getElementById('results');
    const opt = {
        margin: 1,
        filename: 'business_dna_analysis.pdf',
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2 },
        jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' }
    };

    try {
        await html2pdf().set(opt).from(element).save();
        showNotification('PDF exported successfully');
    } catch (error) {
        showNotification('Failed to export PDF', 'error');
        console.error('PDF Export Error:', error);
    }
}

function exportToExcel() {
    showNotification('Preparing Excel export...');
    
    try {
        const data = collectExcelData();
        const wb = XLSX.utils.book_new();
        
        // Financial Metrics Sheet
        const wsFinancial = XLSX.utils.json_to_sheet(data.financial);
        XLSX.utils.book_append_sheet(wb, wsFinancial, "Financial Metrics");
        
        // Growth Metrics Sheet
        const wsGrowth = XLSX.utils.json_to_sheet(data.growth);
        XLSX.utils.book_append_sheet(wb, wsGrowth, "Growth Analysis");
        
        // Market Position Sheet
        const wsMarket = XLSX.utils.json_to_sheet(data.market);
        XLSX.utils.book_append_sheet(wb, wsMarket, "Market Position");
        
        // Recommendations Sheet
        const wsRecommendations = XLSX.utils.json_to_sheet(data.recommendations);
        XLSX.utils.book_append_sheet(wb, wsRecommendations, "Recommendations");
        
        XLSX.writeFile(wb, "business_dna_analysis.xlsx");
        showNotification('Excel file exported successfully');
    } catch (error) {
        showNotification('Failed to export Excel file', 'error');
        console.error('Excel Export Error:', error);
    }
}

function collectExcelData() {
    return {
        financial: [
            {
                metric: 'Profit Margin',
                value: latestData.analysis.financial.profit_margin + '%'
            },
            {
                metric: 'Current Ratio',
                value: latestData.analysis.financial.current_ratio.toFixed(2)
            },
            {
                metric: 'Quick Ratio',
                value: latestData.analysis.financial.quick_ratio.toFixed(2)
            },
            {
                metric: 'Working Capital',
                value: formatIndianCurrency(latestData.analysis.financial.working_capital)
            }
        ],
        growth: [
            {
                metric: 'Average Growth Rate',
                value: latestData.analysis.growth.avg_growth_rate + '%'
            },
            {
                metric: 'CAGR',
                value: latestData.analysis.growth.cagr + '%'
            },
            {
                metric: 'Growth Trend',
                value: latestData.analysis.growth.growth_trend
            }
        ],
        market: [
            {
                metric: 'Market Share',
                value: latestData.analysis.market.market_share + '%'
            },
            {
                metric: 'Competitive Position',
                value: latestData.analysis.market.competitive_position
            },
            {
                metric: 'Employee Productivity',
                value: formatIndianCurrency(latestData.analysis.market.employee_productivity)
            }
        ],
        recommendations: latestData.recommendations.map(rec => ({
            category: rec.category,
            priority: rec.priority,
            description: rec.description
        }))
    };
}

// Form Submission Handler
let latestData = null; // Store the latest analysis results

document.getElementById('analysisForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    showLoading();

    try {
        const formData = new FormData(e.target);
        const data = Object.fromEntries(formData.entries());
        
        // Validate form data
        validateFinancialData(data);
        validateHistoricalData(data);

        const response = await fetch('https://dna-backend-1091742458180.us-central1.run.app/analyze', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data)
        });

        if (!response.ok) {
            throw new Error('Analysis failed. Please check your input data.');
        }

        latestData = await response.json();

        // Show the results container
        const resultsContainer = document.getElementById('results');
        resultsContainer.classList.remove('hidden');

        // Display company name
        document.getElementById('companyName').textContent = data.company_name;

        // Create and display charts
        createPerformanceGauge(85); // Example score
        createFinancialMetricsChart(latestData);
        createTrendAnalysisChart(latestData);
        createRiskRadarChart(latestData);

        // Display metrics
        displayFinancialMetrics(latestData);
        displayGrowthMetrics(latestData);
        displayMarketMetrics(latestData);
        displaySWOTAnalysis(latestData);
        displayRecommendations(latestData);
        displayComplianceStatus(latestData);

        showNotification('Analysis completed successfully');
        
        // Smooth scroll to results
        resultsContainer.scrollIntoView({ 
            behavior: 'smooth',
            block: 'start'
        });

    } catch (error) {
        showNotification(error.message, 'error');
        console.error('Analysis Error:', error);
    } finally {
        hideLoading();
    }
});

// Initialize tooltips and other UI components
document.addEventListener('DOMContentLoaded', () => {
    // Initialize tooltip event listeners
    document.querySelectorAll('.tooltip').forEach(tooltip => {
        tooltip.addEventListener('mouseenter', () => {
            tooltip.querySelector('.tooltip-text').style.visibility = 'visible';
            tooltip.querySelector('.tooltip-text').style.opacity = '1';
        });
        
        tooltip.addEventListener('mouseleave', () => {
            tooltip.querySelector('.tooltip-text').style.visibility = 'hidden';
            tooltip.querySelector('.tooltip-text').style.opacity = '0';
        });
    });

    // Add input validation listeners
    document.querySelectorAll('input[type="number"]').forEach(input => {
        input.addEventListener('input', (e) => {
            if (e.target.value < 0) {
                e.target.value = 0;
            }
        });
    });
});
    </script>
</body>
</html>